---
phase: 14-node-type-visual-distinction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/nodeTypeStyles.js
  - src/components/trail/icons/TrebleClefIcon.jsx
  - src/components/trail/icons/BassClefIcon.jsx
  - src/components/trail/icons/MetronomeIcon.jsx
  - src/index.css
autonomous: true

must_haves:
  truths:
    - "getNodeTypeIcon returns a React component for any combination of nodeType and category"
    - "getCategoryColors returns Tailwind class strings for all 4 categories in all states (locked, available, current, completed, mastered)"
    - "Locked state overrides category colors to gray"
    - "Boss nodes get gold gradient treatment distinct from regular category colors"
    - "Custom SVG icons match lucide-react API (size, color, strokeWidth, className props)"
    - "Pulse animation CSS respects both prefers-reduced-motion media query and .reduced-motion class"
  artifacts:
    - path: "src/utils/nodeTypeStyles.js"
      provides: "getNodeTypeIcon and getCategoryColors functions"
      exports: ["getNodeTypeIcon", "getCategoryColors", "getNodeStateConfig"]
    - path: "src/components/trail/icons/TrebleClefIcon.jsx"
      provides: "Treble clef SVG icon component"
      exports: ["default"]
    - path: "src/components/trail/icons/BassClefIcon.jsx"
      provides: "Bass clef SVG icon component"
      exports: ["default"]
    - path: "src/components/trail/icons/MetronomeIcon.jsx"
      provides: "Metronome SVG icon component"
      exports: ["default"]
    - path: "src/index.css"
      provides: "animate-pulse-subtle CSS class with reduced-motion support"
      contains: "animate-pulse-subtle"
  key_links:
    - from: "src/utils/nodeTypeStyles.js"
      to: "src/data/nodeTypes.js"
      via: "imports NODE_TYPES"
      pattern: "import.*NODE_TYPES.*from.*nodeTypes"
    - from: "src/utils/nodeTypeStyles.js"
      to: "src/data/constants.js"
      via: "imports NODE_CATEGORIES"
      pattern: "import.*NODE_CATEGORIES.*from.*constants"
    - from: "src/utils/nodeTypeStyles.js"
      to: "src/components/trail/icons/"
      via: "imports custom SVG icons"
      pattern: "import.*ClefIcon|import.*MetronomeIcon"
    - from: "src/utils/nodeTypeStyles.js"
      to: "lucide-react"
      via: "imports lucide icons for non-musical node types"
      pattern: "import.*from 'lucide-react'"
---

<objective>
Create the centralized node type style system: icon mapping, category color palette, and custom musical SVG icons.

Purpose: Provide a single source of truth for all node type visual styling that TrailNode and TrailNodeModal will consume. Separating this from the UI components keeps concerns clean and makes the style system testable.

Output: nodeTypeStyles.js utility with getNodeTypeIcon/getCategoryColors exports, three custom SVG icon components for musical notation, and a subtle pulse CSS animation with accessibility support.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-node-type-visual-distinction/14-CONTEXT.md
@.planning/phases/14-node-type-visual-distinction/14-RESEARCH.md
@src/data/nodeTypes.js
@src/data/constants.js
@src/components/trail/TrailNode.jsx
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create custom musical SVG icon components</name>
  <files>
    src/components/trail/icons/TrebleClefIcon.jsx
    src/components/trail/icons/BassClefIcon.jsx
    src/components/trail/icons/MetronomeIcon.jsx
  </files>
  <action>
Create the `src/components/trail/icons/` directory and three SVG icon components.

Each icon MUST match the lucide-react component API:
- Props: `size` (default 24), `color` (default 'currentColor'), `strokeWidth` (default 2), `className` (default ''), plus `...props` spread
- SVG attributes: `width={size}`, `height={size}`, `viewBox="0 0 24 24"`, `fill="none"`, `stroke={color}`, `strokeWidth={strokeWidth}`, `strokeLinecap="round"`, `strokeLinejoin="round"`, `className={className}`

**TrebleClefIcon.jsx**: Create a simplified, child-friendly treble clef representation. Use a recognizable curved S-shape that 8-year-olds would identify as "the curly music symbol." Keep it simple — 2-3 path elements max. The treble clef's distinctive features are the curl at the bottom, the vertical line, and the loop at the top.

Suggested SVG path approach: A stylized G-clef shape using bezier curves. Something like a vertical line from y=4 to y=22 with a decorative spiral/curl crossing it. This does NOT need to be a photorealistic music symbol — it should be playful and recognizable at 24px.

**BassClefIcon.jsx**: Create a simplified bass clef (F-clef). The distinctive features are the curved body (like a backwards C or comma) and two dots. Use a curved path plus two small circles (r=1) for the dots.

**MetronomeIcon.jsx**: Create a simplified metronome shape. The distinctive features are a triangular/trapezoidal body with a pendulum arm. Use a trapezoid shape (wider at bottom) with a diagonal line representing the pendulum.

All three must be default exports. Keep SVG paths minimal and clean — these render at 20-28px typically.
  </action>
  <verify>
Run: `node -e "import('./src/components/trail/icons/TrebleClefIcon.jsx')" 2>&1` should not throw syntax errors.
Visually verify: Each file exports a function component that accepts size/color/strokeWidth/className props and returns an SVG element.
Check: All three files exist and have consistent structure.
  </verify>
  <done>Three custom SVG icon components exist in src/components/trail/icons/ matching lucide-react API (size, color, strokeWidth, className props).</done>
</task>

<task type="auto">
  <name>Task 2: Create nodeTypeStyles.js utility and pulse animation CSS</name>
  <files>
    src/utils/nodeTypeStyles.js
    src/index.css
  </files>
  <action>
**Create src/utils/nodeTypeStyles.js** with three exported functions:

1. **`getNodeTypeIcon(nodeType, category)`** — Returns a React component (not an instance).
   - Import `Search, Gamepad2, Zap, RotateCcw, Dumbbell, Crown, Trophy` from 'lucide-react' (VISUAL-04 requirement)
   - Import custom icons: TrebleClefIcon, BassClefIcon, MetronomeIcon
   - Import NODE_TYPES from '../data/nodeTypes.js'
   - Import NODE_CATEGORIES from '../data/constants.js'
   - Logic (ordered by priority — first match wins):
     - If `nodeType === NODE_TYPES.BOSS`: return `Trophy`
     - If `nodeType === NODE_TYPES.MINI_BOSS`: return `Crown`
     - If `category === NODE_CATEGORIES.TREBLE_CLEF`: return `TrebleClefIcon`
     - If `category === NODE_CATEGORIES.BASS_CLEF`: return `BassClefIcon`
     - If `category === NODE_CATEGORIES.RHYTHM`: return `MetronomeIcon`
     - For remaining node types (regardless of category): use `Search` for DISCOVERY, `Gamepad2` for MIX_UP, `Zap` for SPEED_ROUND, `RotateCcw` for REVIEW, `Dumbbell` for CHALLENGE
     - Fallback: `Search`
   - NOTE: Boss/mini-boss check BEFORE category check. This means boss nodes always show trophy/crown regardless of which category they belong to. This is intentional per CONTEXT.md boss visual distinction requirement.

2. **`getCategoryColors(category, state)`** — Returns an object with Tailwind class strings.
   - `state` parameter: 'locked' | 'available' | 'current' | 'completed' | 'mastered'
   - Return shape: `{ bg, border, text, icon, glow }` where each value is a string of Tailwind classes
   - **State hierarchy** (locked overrides everything):
     - `locked`: `{ bg: 'bg-gray-700', border: 'border-gray-600', text: 'text-gray-500', icon: 'opacity-40', glow: '' }`
   - **Boss category** (NODE_CATEGORIES.BOSS — gold treatment):
     - `{ bg: 'bg-gradient-to-br from-yellow-400 to-amber-500', border: 'border-yellow-400', text: 'text-amber-900', icon: 'opacity-100', glow: 'shadow-[0_0_20px_rgba(234,179,8,0.5)]' }`
   - **Category colors** (accessible, child-friendly, colorblind-safe since icons differentiate):
     - treble_clef: `{ bg: 'bg-gradient-to-br from-blue-500 to-indigo-600', border: 'border-blue-400', text: 'text-white', icon: 'opacity-100', glow: 'shadow-[0_0_15px_rgba(59,130,246,0.4)]' }`
     - bass_clef: `{ bg: 'bg-gradient-to-br from-purple-500 to-violet-600', border: 'border-purple-400', text: 'text-white', icon: 'opacity-100', glow: 'shadow-[0_0_15px_rgba(168,85,247,0.4)]' }`
     - rhythm: `{ bg: 'bg-gradient-to-br from-emerald-500 to-teal-600', border: 'border-emerald-400', text: 'text-white', icon: 'opacity-100', glow: 'shadow-[0_0_15px_rgba(16,185,129,0.4)]' }`
   - Fallback to treble_clef colors if category unknown
   - NOTE: The gradients are chosen to be maximally distinguishable for colorblind users: blue vs purple vs green are well-separated in all three major colorblindness types (protanopia, deuteranopia, tritanopia). Boss gold is also distinct.

3. **`getNodeStateConfig(nodeType, category, state, isBoss)`** — Convenience function returning combined styling.
   - Returns: `{ IconComponent, colors, sizeClass, pulseClass, crownVisible }`
   - `IconComponent`: Result of getNodeTypeIcon(nodeType, category)
   - `colors`: Result of getCategoryColors(isBoss ? NODE_CATEGORIES.BOSS : category, state)
   - `sizeClass`: If isBoss: `'h-14 w-14'`, else `'h-12 w-12'` (boss nodes 15% larger per RESEARCH.md)
   - `pulseClass`: If state is 'current' or 'available': `'animate-pulse-subtle'`, else `''`
   - `crownVisible`: `isBoss && state !== 'locked'` (show crown only on unlocked boss nodes)

**Update src/index.css** — Add a subtle pulse animation at the end of the file, BEFORE the closing of any existing section:

```css
/* ========================================
   TRAIL NODE ANIMATIONS
   ======================================== */

@keyframes pulse-subtle {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(255, 255, 255, 0);
  }
}

.animate-pulse-subtle {
  animation: pulse-subtle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* Respect system preference */
@media (prefers-reduced-motion: reduce) {
  .animate-pulse-subtle {
    animation: none;
  }
}

/* Respect AccessibilityContext setting */
.reduced-motion .animate-pulse-subtle {
  animation: none;
}
```

This replaces the existing `animate-pulse` class usage (Tailwind's built-in which scales the entire element). The new `animate-pulse-subtle` uses a ring/glow effect instead — more noticeable on the dark trail background and less visually disruptive than scale animation.
  </action>
  <verify>
Run: `npm run build` — should complete with no errors (verifies imports resolve correctly).
Check: `src/utils/nodeTypeStyles.js` exports getNodeTypeIcon, getCategoryColors, getNodeStateConfig.
Check: `src/index.css` contains `.animate-pulse-subtle` class with `prefers-reduced-motion` and `.reduced-motion` overrides.
Grep: `import.*NODE_TYPES.*from` in nodeTypeStyles.js confirms link to data layer.
Grep: `import.*NODE_CATEGORIES.*from` in nodeTypeStyles.js confirms link to constants.
  </verify>
  <done>nodeTypeStyles.js exports three functions that map node types/categories/states to icons and colors. CSS contains accessible pulse animation. Build succeeds.</done>
</task>

</tasks>

<verification>
1. `npm run build` passes — all imports resolve, no type errors
2. nodeTypeStyles.js imports from nodeTypes.js, constants.js, lucide-react, and custom SVG icons
3. Custom SVG icons in src/components/trail/icons/ have consistent API matching lucide-react
4. CSS animation has both @media and class-based reduced-motion overrides
5. getCategoryColors returns gray styling when state is 'locked' for ALL categories
6. getNodeTypeIcon returns Trophy for BOSS, Crown for MINI_BOSS regardless of category
</verification>

<success_criteria>
- Three custom SVG icon components exist and export React components with lucide-react-compatible API
- nodeTypeStyles.js provides getNodeTypeIcon, getCategoryColors, and getNodeStateConfig
- Icon mapping covers all 8 NODE_TYPES and all 4 NODE_CATEGORIES
- Color system maintains state hierarchy: locked (gray) > boss (gold) > category color
- CSS pulse animation respects reduced motion via both media query and class
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-node-type-visual-distinction/14-01-SUMMARY.md`
</output>
