---
phase: 13-celebration-foundation-accessibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/celebrationConstants.js
  - src/components/celebrations/useCelebrationDuration.js
  - src/components/celebrations/CelebrationWrapper.jsx
  - src/components/celebrations/CelebrationWrapper.css
autonomous: true

must_haves:
  truths:
    - "When reducedMotion is enabled, celebration animations use opacity-only transitions (no transforms, no bounce, no scale)"
    - "When extendedTimeouts is enabled, celebration durations are extended by 1.5x"
    - "Users can skip any celebration by clicking anywhere, pressing ESC, or pressing Enter"
    - "Standard celebrations complete within 500ms, level-up within 1000ms, boss within 3000ms"
    - "A visible 'Tap to continue' hint appears during celebrations so 8-year-olds know they can skip"
  artifacts:
    - path: "src/utils/celebrationConstants.js"
      provides: "Duration tiers, extended timeout multiplier, skip keycodes"
      exports: ["CELEBRATION_TIERS", "EXTENDED_TIMEOUT_MULTIPLIER"]
    - path: "src/components/celebrations/useCelebrationDuration.js"
      provides: "Hook that calculates celebration duration from tier + accessibility settings"
      exports: ["useCelebrationDuration"]
    - path: "src/components/celebrations/CelebrationWrapper.jsx"
      provides: "Wrapper component with skip functionality, auto-dismiss, and accessibility"
      exports: ["CelebrationWrapper"]
    - path: "src/components/celebrations/CelebrationWrapper.css"
      provides: "CSS animations with reduced-motion alternatives"
      contains: ".celebration-wrapper"
  key_links:
    - from: "src/components/celebrations/CelebrationWrapper.jsx"
      to: "src/contexts/AccessibilityContext.jsx"
      via: "useAccessibility hook"
      pattern: "useAccessibility"
    - from: "src/components/celebrations/CelebrationWrapper.jsx"
      to: "src/components/celebrations/useCelebrationDuration.js"
      via: "hook import"
      pattern: "useCelebrationDuration"
    - from: "src/components/celebrations/useCelebrationDuration.js"
      to: "src/utils/celebrationConstants.js"
      via: "constants import"
      pattern: "CELEBRATION_TIERS"
---

<objective>
Create the accessibility-first celebration foundation: constants, duration hook, wrapper component, and CSS animations with reduced-motion alternatives.

Purpose: Establish the animation infrastructure that Phases 14-17 will build upon. Every future celebration (confetti, boss unlock, level-up, XP animations) will use this wrapper to automatically respect accessibility settings.

Output: Four new files forming the celebration foundation layer.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-celebration-foundation-accessibility/13-CONTEXT.md
@.planning/phases/13-celebration-foundation-accessibility/13-RESEARCH.md
@src/contexts/AccessibilityContext.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create celebration constants and duration hook</name>
  <files>
    src/utils/celebrationConstants.js
    src/components/celebrations/useCelebrationDuration.js
  </files>
  <action>
Create `src/utils/celebrationConstants.js` with:
- `CELEBRATION_TIERS` object: `{ standard: 500, 'level-up': 1000, boss: 3000 }` (milliseconds)
- `EXTENDED_TIMEOUT_MULTIPLIER`: `1.5`
- `REDUCED_MOTION_DURATION`: `100` (minimum ms for visual feedback even in reduced motion)
- `SKIP_KEYS`: `['Escape', 'Enter']` (keyboard shortcuts to dismiss celebrations)
- Export all constants as named exports

Create `src/components/celebrations/useCelebrationDuration.js` with:
- Custom hook `useCelebrationDuration(tier, options)` where tier is `'standard' | 'level-up' | 'boss'` and options has `{ reducedMotion, extendedTimeouts }`
- Import `CELEBRATION_TIERS`, `EXTENDED_TIMEOUT_MULTIPLIER`, `REDUCED_MOTION_DURATION` from celebrationConstants
- Use `useMemo` to calculate duration:
  - If `reducedMotion` is true, return `REDUCED_MOTION_DURATION` (100ms)
  - Otherwise, start with `CELEBRATION_TIERS[tier]` (fallback to standard)
  - If `extendedTimeouts` is true, multiply by `EXTENDED_TIMEOUT_MULTIPLIER`
  - Return the calculated duration
- Export the hook as named export
  </action>
  <verify>
Files exist at expected paths. Constants export correctly. Hook returns expected values:
- `useCelebrationDuration('standard', { reducedMotion: false, extendedTimeouts: false })` returns 500
- `useCelebrationDuration('boss', { reducedMotion: true, extendedTimeouts: false })` returns 100
- `useCelebrationDuration('standard', { reducedMotion: false, extendedTimeouts: true })` returns 750
  </verify>
  <done>
celebrationConstants.js exports CELEBRATION_TIERS, EXTENDED_TIMEOUT_MULTIPLIER, REDUCED_MOTION_DURATION, SKIP_KEYS. useCelebrationDuration hook returns correct duration based on tier, reducedMotion, and extendedTimeouts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CelebrationWrapper component with CSS</name>
  <files>
    src/components/celebrations/CelebrationWrapper.jsx
    src/components/celebrations/CelebrationWrapper.css
  </files>
  <action>
Create `src/components/celebrations/CelebrationWrapper.css` with:
- `.celebration-wrapper` base styles: `position: relative; cursor: pointer;`
- `.celebration-full` class: children animate with transforms (scale, translateY) using `var(--celebration-duration)` CSS variable
- `.celebration-reduced` class: children animate with opacity-only transitions (NO transforms, NO scale, NO bounce) using 100ms duration
- `.celebration-star` keyframe `bounce-and-glow`: `0% { scale(0) translateY(20px) opacity:0 } 50% { scale(1.2) translateY(-10px) opacity:1 } 100% { scale(1) translateY(0) opacity:1 }`
- `.reduced-motion .celebration-star` or `.celebration-reduced .celebration-star`: use `fade-in` keyframe (opacity 0 to 1, 100ms)
- `.celebration-skip-hint` styles: fixed bottom-right, pill-shaped, semi-transparent dark background, white text, subtle pulse animation, `pointer-events: none`, font-size 14px. Text content "Tap to continue" via CSS `content` or render in JSX.
- `.celebration-skip-hint` in `.celebration-reduced`: no pulse animation (static opacity)
- Media query `@media (prefers-reduced-motion: reduce)` as CSS fallback for cases where AccessibilityContext hasn't loaded yet

Create `src/components/celebrations/CelebrationWrapper.jsx` with:
- Import `useAccessibility` from `../../contexts/AccessibilityContext`
- Import `useCelebrationDuration` from `./useCelebrationDuration`
- Import `SKIP_KEYS` from `../../utils/celebrationConstants`
- Import `./CelebrationWrapper.css`
- Props: `{ children, tier = 'standard', onComplete, autoStart = true, className = '' }`
- Read `reducedMotion` and `extendedTimeouts` from `useAccessibility()`
- Calculate duration via `useCelebrationDuration(tier, { reducedMotion, extendedTimeouts })`
- `handleSkip` function: clear any active timeout, call `onComplete?.()` immediately
- `useEffect` for keyboard skip: listen for `keydown` events, if `SKIP_KEYS.includes(e.key)` then `e.preventDefault()` and call `handleSkip()`. Clean up listener on unmount.
- `useEffect` for auto-dismiss: if `autoStart` and `onComplete`, set timeout for `duration` ms then call `onComplete()`. Clean up timeout on unmount. Use `useRef` for timeout ID.
- Use `useCallback` for `handleSkip` with stable reference (use refs for timeout to avoid stale closures)
- Render: `<div>` with ref, className combining `celebration-wrapper`, `celebration-full` or `celebration-reduced` based on `reducedMotion`, and passed `className`. Set CSS variable `--celebration-duration` via inline style. `onClick={handleSkip}`. `role="presentation"`. `aria-label="Celebration animation. Click or press Escape to skip."`
- Render children inside the wrapper div
- Render skip hint: a `<span>` with className `celebration-skip-hint` containing text appropriate for 8-year-olds (e.g., "Tap to continue" or "Click to skip"). This should be rendered in JSX rather than CSS content for i18n compatibility.
- Export `CelebrationWrapper` as named export and default export

IMPORTANT: The click handler on the wrapper div must NOT interfere with interactive elements (buttons, links) inside the celebration. Check if `e.target` is closest to a `button, a, [role="button"]` -- if so, let the click through without skipping. This prevents the "Next Exercise" or "Back to Trail" buttons from triggering a skip instead of their intended action.
  </action>
  <verify>
1. `npm run build` succeeds (no import errors, no syntax errors)
2. The CelebrationWrapper component:
   - Renders children
   - Applies `celebration-full` class when reducedMotion is false
   - Applies `celebration-reduced` class when reducedMotion is true
   - Sets `--celebration-duration` CSS variable on the wrapper
   - Has click handler on wrapper div
   - Has keyboard listener for Escape and Enter
   - Auto-dismisses after calculated duration
   - Shows skip hint text
  </verify>
  <done>
CelebrationWrapper.jsx exports a working component that wraps celebration content with accessibility-aware animation classes, auto-dismiss timer, skip-on-click, skip-on-keyboard (ESC/Enter), and a visible "Tap to continue" hint. CelebrationWrapper.css provides full and reduced-motion animation variants. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. `npm run lint` passes (or only pre-existing warnings)
3. Files exist: `src/utils/celebrationConstants.js`, `src/components/celebrations/useCelebrationDuration.js`, `src/components/celebrations/CelebrationWrapper.jsx`, `src/components/celebrations/CelebrationWrapper.css`
4. CelebrationWrapper imports useAccessibility from AccessibilityContext (key_link verified)
5. useCelebrationDuration imports from celebrationConstants (key_link verified)
6. No new npm dependencies added (zero new packages)
</verification>

<success_criteria>
- Four new files created forming the celebration foundation
- CelebrationWrapper reads reducedMotion and extendedTimeouts from AccessibilityContext
- Duration hook returns correct values for all tier/accessibility combinations
- Skip functionality supports click, ESC, and Enter
- CSS provides both full-animation and reduced-motion variants
- Build succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-celebration-foundation-accessibility/13-01-SUMMARY.md`
</output>
