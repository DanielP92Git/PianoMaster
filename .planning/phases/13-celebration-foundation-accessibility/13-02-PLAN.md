---
phase: 13-celebration-foundation-accessibility
plan: 02
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - src/components/games/VictoryScreen.jsx
autonomous: true

must_haves:
  truths:
    - "Star bounce animation in VictoryScreen does NOT play when reducedMotion is enabled (uses opacity fade instead)"
    - "useCountUp hook skips animation and shows final value instantly when reducedMotion is enabled"
    - "Level-up badge bounce animation does NOT play when reducedMotion is enabled"
    - "VictoryScreen star animation duration uses celebration duration system instead of hardcoded 600ms"
    - "All existing VictoryScreen functionality (trail completion, XP award, button navigation) continues to work unchanged"
  artifacts:
    - path: "src/components/games/VictoryScreen.jsx"
      provides: "Accessibility-aware VictoryScreen with reducedMotion support"
      contains: "useAccessibility"
  key_links:
    - from: "src/components/games/VictoryScreen.jsx"
      to: "src/contexts/AccessibilityContext.jsx"
      via: "useAccessibility hook for reducedMotion"
      pattern: "useAccessibility"
    - from: "src/components/games/VictoryScreen.jsx"
      to: "src/utils/celebrationConstants.js"
      via: "CELEBRATION_TIERS or REDUCED_MOTION_DURATION import"
      pattern: "celebrationConstants|CELEBRATION_TIERS|REDUCED_MOTION_DURATION"
---

<objective>
Make VictoryScreen's existing animations respect the AccessibilityContext reducedMotion setting, using the celebration foundation from Plan 01.

Purpose: VictoryScreen already has star bounce animations (lines 642-658), a count-up animation (useCountUp hook), and a level-up badge bounce. None of these currently check reducedMotion. This plan wires them into the accessibility system so users with motion sensitivity get instant values and opacity-only transitions.

Output: Updated VictoryScreen.jsx with accessibility-aware animations.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-celebration-foundation-accessibility/13-CONTEXT.md
@.planning/phases/13-celebration-foundation-accessibility/13-RESEARCH.md
@.planning/phases/13-celebration-foundation-accessibility/13-01-SUMMARY.md
@src/components/games/VictoryScreen.jsx
@src/contexts/AccessibilityContext.jsx
@src/utils/celebrationConstants.js
@src/components/celebrations/useCelebrationDuration.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make VictoryScreen animations accessibility-aware</name>
  <files>src/components/games/VictoryScreen.jsx</files>
  <action>
Modify `src/components/games/VictoryScreen.jsx` to respect reducedMotion:

1. **Import accessibility hook:**
   Add `import { useAccessibility } from '../../contexts/AccessibilityContext';` at top of file.
   Add `import { REDUCED_MOTION_DURATION } from '../../utils/celebrationConstants';` for the duration constant.

2. **Read reducedMotion in component:**
   Inside the VictoryScreen component function, add: `const { reducedMotion } = useAccessibility();`

3. **Update useCountUp hook (lines ~22-56):**
   - Add `reducedMotion` as a parameter (5th argument, default false): `const useCountUp = (start, end, duration = 1400, shouldAnimate = true, reducedMotion = false)`
   - In the initial state callback, add reducedMotion check: `if (reducedMotion || !shouldAnimate) { return end ?? start ?? 0; }`
   - In the useEffect, add reducedMotion to the skip condition: `if (reducedMotion || !shouldAnimate || start === end) { setValue(end); return; }`
   - Add `reducedMotion` to the useEffect dependency array

4. **Pass reducedMotion to useCountUp call (line ~129-134):**
   Change the existing call from:
   `const animatedTotal = useCountUp(basePoints, pointsTarget, 1400, shouldAnimate);`
   To:
   `const animatedTotal = useCountUp(basePoints, pointsTarget, 1400, shouldAnimate, reducedMotion);`

5. **Update star animation (lines ~642-658):**
   Replace the star animation classes. Currently:
   ```jsx
   className={`text-3xl transition-all duration-300 ${
     starNum <= stars
       ? 'animate-bounce text-yellow-400 drop-shadow-lg'
       : 'text-gray-400/30'
   }`}
   style={{
     animationDelay: `${starNum * 100}ms`,
     animationDuration: '600ms'
   }}
   ```
   Change to conditionally apply animation based on reducedMotion:
   ```jsx
   className={`text-3xl ${
     starNum <= stars
       ? reducedMotion
         ? 'text-yellow-400 drop-shadow-lg'
         : 'animate-bounce text-yellow-400 drop-shadow-lg'
       : 'text-gray-400/30'
   } ${!reducedMotion ? 'transition-all duration-300' : 'transition-opacity duration-100'}`}
   style={reducedMotion ? {} : {
     animationDelay: `${starNum * 100}ms`,
     animationDuration: '600ms'
   }}
   ```
   When reducedMotion is true: no `animate-bounce`, no animationDelay/Duration, use `transition-opacity duration-100` instead of `transition-all duration-300`.

6. **Update level-up badge animation (line ~681):**
   Currently has `animate-bounce` class on the level-up badge div.
   Change to: `${reducedMotion ? '' : 'animate-bounce'}` so the bounce is removed when reducedMotion is enabled.

7. **Preserve all existing functionality:**
   Do NOT change any trail completion logic, XP awarding, button handlers, navigation, exercise tracking, rate limiting, accessory unlock detection, or query invalidation. Only animation-related classes and the useCountUp hook are modified.

IMPORTANT: The useCountUp hook is defined INSIDE VictoryScreen.jsx (not imported from elsewhere). Modify it in place. The `reducedMotion` variable from `useAccessibility()` is available in the VictoryScreen component scope but NOT in the useCountUp hook scope (it's a separate function). Either:
- Pass reducedMotion as a parameter to useCountUp (recommended, cleaner), OR
- Move the useAccessibility call above the hook definition and pass it through

The recommended approach is passing as parameter since useCountUp is a standalone hook function defined outside the component.
  </action>
  <verify>
1. `npm run build` succeeds
2. `npm run lint` passes (or only pre-existing warnings)
3. Grep confirms `useAccessibility` is imported and called in VictoryScreen.jsx
4. Grep confirms `reducedMotion` is used in star animation conditional
5. Grep confirms `animate-bounce` is conditionally applied (not always present)
6. Grep confirms useCountUp has reducedMotion parameter
7. No functionality changes beyond animation behavior (no changes to trail logic, XP, navigation)
  </verify>
  <done>
VictoryScreen.jsx imports useAccessibility, reads reducedMotion. Star bounce animation is conditionally applied (skipped when reducedMotion=true, uses opacity-only). useCountUp skips to final value when reducedMotion=true. Level-up badge bounce is conditionally applied. All existing non-animation functionality unchanged. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. `npm run lint` passes
3. VictoryScreen.jsx imports `useAccessibility` from AccessibilityContext
4. VictoryScreen.jsx uses `reducedMotion` to conditionally apply star bounce, count-up animation, and level-up badge bounce
5. No new npm dependencies added
6. Existing VictoryScreen props and behavior unchanged (nodeId, exerciseIndex, totalExercises, exerciseType, onNextExercise all still work)
7. Service worker (`public/sw.js`) already excludes JS files from caching (lines 173-176) - no changes needed. Vite's content-hashed chunks ensure cache invalidation on deploy.
</verification>

<success_criteria>
- VictoryScreen star animations respect reducedMotion (no bounce/scale when enabled)
- useCountUp shows final value instantly when reducedMotion is enabled
- Level-up badge does not bounce when reducedMotion is enabled
- All trail completion, XP, and navigation functionality unchanged
- Build and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/13-celebration-foundation-accessibility/13-02-SUMMARY.md`
</output>
