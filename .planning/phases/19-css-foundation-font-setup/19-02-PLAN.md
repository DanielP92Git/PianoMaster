---
phase: 19-css-foundation-font-setup
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - src/pages/TrailMapPage.jsx
autonomous: false

must_haves:
  truths:
    - "Trail page displays enchanted forest background with deep purple/navy gradients"
    - "Ambient glow orbs visible at bottom of trail page (purple, blue, green)"
    - "Starfield twinkles with multiple star sizes and durations"
    - "Stars stop animating when reduced motion is enabled (OS setting or app setting)"
    - "Trail page text renders in Quicksand font"
    - "No visual changes to any page other than the trail page"
  artifacts:
    - path: "src/pages/TrailMapPage.jsx"
      provides: "Enchanted forest background with starfield, glow orbs, Quicksand font, and reduced-motion support"
      contains: "trail-forest-bg"
  key_links:
    - from: "src/pages/TrailMapPage.jsx"
      to: "src/styles/trail-effects.css"
      via: "CSS import"
      pattern: "import.*trail-effects"
    - from: "src/pages/TrailMapPage.jsx"
      to: "AccessibilityContext"
      via: "useAccessibility hook for reducedMotion"
      pattern: "useAccessibility|reducedMotion"
    - from: "src/pages/TrailMapPage.jsx"
      to: "Tailwind font-quicksand"
      via: "className on wrapper div"
      pattern: "font-quicksand"
---

<objective>
Apply the enchanted forest visual foundation to TrailMapPage.jsx by importing trail-effects.css, replacing the existing flat gradient background with the multi-layer forest background, adding ambient glow orbs and proper starfield, scoping Quicksand font, and integrating reduced-motion support via AccessibilityContext.

Purpose: Transform the trail page from a flat dark gradient into an immersive enchanted forest backdrop that serves as the visual canvas for Phase 20 node enhancements.

Output: Updated TrailMapPage.jsx with enchanted forest visuals and a checkpoint for visual verification.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-css-foundation-font-setup/19-01-SUMMARY.md
@src/pages/TrailMapPage.jsx
@src/styles/trail-effects.css
@src/contexts/AccessibilityContext.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply Enchanted Forest Background to TrailMapPage</name>
  <files>src/pages/TrailMapPage.jsx</files>
  <action>
Update `src/pages/TrailMapPage.jsx` with the following changes:

1. **Add imports** at the top of the file (after existing imports):
   ```javascript
   import { useAccessibility } from '../contexts/AccessibilityContext';
   import '../styles/trail-effects.css';
   ```

2. **Get reducedMotion** from AccessibilityContext inside the component:
   ```javascript
   const { reducedMotion } = useAccessibility();
   ```

3. **Replace the outer wrapper div** (currently line 28):
   Change from:
   ```jsx
   <div className="fixed inset-0 overflow-y-auto bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900" dir={...}>
   ```
   To:
   ```jsx
   <div className="trail-page trail-forest-bg fixed inset-0 overflow-y-auto font-quicksand" dir={...}>
   ```
   The `trail-page` class activates CSS custom properties. The `trail-forest-bg` class applies the enchanted forest gradient. The `font-quicksand` class scopes Quicksand to this page only (FONT-01b).

4. **Replace the existing starfield section** (currently lines 30-43, the 8 random stars with inline styles):
   Replace with a proper starfield using the `trail-star` class from trail-effects.css. Generate 20 stars with varied sizes and positions. Use deterministic positions (not Math.random() which causes hydration issues on re-render). Use CSS custom properties for duration and delay:

   ```jsx
   {/* Enchanted starfield */}
   <div className="pointer-events-none absolute inset-0 overflow-hidden" aria-hidden="true">
     {[
       { left: '5%', top: '8%', size: 2, duration: '3s', delay: '0s' },
       { left: '15%', top: '22%', size: 1, duration: '4s', delay: '1.2s' },
       { left: '25%', top: '5%', size: 3, duration: '3.5s', delay: '0.5s' },
       { left: '35%', top: '35%', size: 1, duration: '5s', delay: '2s' },
       { left: '45%', top: '12%', size: 2, duration: '3.8s', delay: '0.8s' },
       { left: '55%', top: '28%', size: 1, duration: '4.2s', delay: '1.5s' },
       { left: '65%', top: '7%', size: 2, duration: '3.2s', delay: '0.3s' },
       { left: '75%', top: '18%', size: 3, duration: '4.5s', delay: '1.8s' },
       { left: '85%', top: '32%', size: 1, duration: '3.7s', delay: '2.5s' },
       { left: '92%', top: '10%', size: 2, duration: '4s', delay: '0.7s' },
       { left: '10%', top: '45%', size: 1, duration: '5.2s', delay: '1s' },
       { left: '30%', top: '55%', size: 2, duration: '3.3s', delay: '2.2s' },
       { left: '50%', top: '42%', size: 1, duration: '4.8s', delay: '0.4s' },
       { left: '70%', top: '60%', size: 3, duration: '3.6s', delay: '1.7s' },
       { left: '88%', top: '48%', size: 1, duration: '4.3s', delay: '2.8s' },
       { left: '20%', top: '72%', size: 2, duration: '3.9s', delay: '0.6s' },
       { left: '40%', top: '68%', size: 1, duration: '5s', delay: '1.3s' },
       { left: '60%', top: '75%', size: 2, duration: '3.4s', delay: '2.1s' },
       { left: '80%', top: '65%', size: 1, duration: '4.6s', delay: '0.9s' },
       { left: '95%', top: '78%', size: 2, duration: '3.1s', delay: '1.6s' },
     ].map((star, i) => (
       <div
         key={`star-${i}`}
         className="trail-star"
         style={{
           left: star.left,
           top: star.top,
           width: `${star.size}px`,
           height: `${star.size}px`,
           '--star-duration': star.duration,
           '--star-delay': star.delay,
         }}
       />
     ))}
   </div>
   ```

   Note: The `trail-star` class in trail-effects.css handles the animation AND the reduced-motion overrides via both CSS media query and `.reduced-motion` class. No need for a JS-level `reducedMotion` check here since the CSS handles it.

5. **Add ambient glow orbs** AFTER the starfield div and BEFORE the navigation bar:
   ```jsx
   {/* Ambient glow orbs (bottom-of-screen forest glow, matching Stitch reference) */}
   <div className="pointer-events-none absolute inset-0 overflow-hidden" aria-hidden="true">
     <div
       className="trail-glow-orb trail-glow-orb--purple"
       style={{ bottom: '40px', left: '16px', width: '48px', height: '48px', opacity: 0.6 }}
     />
     <div
       className="trail-glow-orb trail-glow-orb--blue"
       style={{ bottom: '80px', right: '40px', width: '64px', height: '64px', opacity: 0.5 }}
     />
     <div
       className="trail-glow-orb trail-glow-orb--green"
       style={{ bottom: '20px', left: '40%', width: '40px', height: '40px', opacity: 0.4 }}
     />
   </div>
   ```

6. **Remove the inline style tag** at the bottom of the component (lines 78-83, the `<style>` block with the `@keyframes twinkle`). This is no longer needed since trail-effects.css contains the starfield animation.

7. **Update the navigation bar** to use glass styling (it already has `bg-slate-900/80 backdrop-blur-sm`). Keep the existing nav bar exactly as-is for now -- the glass styling will be applied in Phase 20. DO NOT change the nav bar in this plan.

8. **Ensure the `reducedMotion` variable is available** for future use in this component (Phase 20 will need it for Framer Motion). The import and hook call from step 1-2 is sufficient.

IMPORTANT: Do NOT modify the `<TrailMap />` component or the navigation bar structure. Only the wrapper div, starfield, and glow orbs change in this plan.
  </action>
  <verify>
1. Run `npm run build` -- zero errors
2. Run `npm run dev` and navigate to `/trail` -- verify the page loads
3. Grep `src/pages/TrailMapPage.jsx` for `trail-forest-bg` -- must find 1 occurrence
4. Grep `src/pages/TrailMapPage.jsx` for `font-quicksand` -- must find 1 occurrence
5. Grep `src/pages/TrailMapPage.jsx` for `trail-star` -- must find 1 occurrence
6. Grep `src/pages/TrailMapPage.jsx` for `trail-glow-orb` -- must find 3 occurrences
7. Grep `src/pages/TrailMapPage.jsx` for `@keyframes` -- must find 0 occurrences (inline style removed)
8. Verify import of `trail-effects.css` exists
9. Verify import of `useAccessibility` exists
  </verify>
  <done>
TrailMapPage displays enchanted forest background with multi-layer gradients, 20 twinkling stars with varied sizes/durations, 3 ambient glow orbs at bottom, and all text in Quicksand font. Inline twinkle animation removed in favor of trail-effects.css module. Reduced-motion handled by CSS (both media query and .reduced-motion class).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Enchanted forest visual foundation on the trail page:
- Deep purple/navy gradient background (replacing flat slate gradient)
- 20 twinkling stars with varied sizes, positions, and timing
- 3 ambient glow orbs at bottom (purple, blue, green)
- All trail page text now in Quicksand font (rounded, kid-friendly)
- Reduced motion: stars stop twinkling when OS reduced motion is enabled
  </what-built>
  <how-to-verify>
1. Run `npm run dev` and navigate to http://localhost:5174/trail
2. Verify the background is a deep purple/navy gradient (NOT the old flat slate-900 gradient)
3. Verify you can see small white dots twinkling (stars) across the page
4. Scroll to bottom and verify soft colored glow orbs are visible (purple on left, blue on right, green in center)
5. Verify the heading text ("Learning Trail" and navigation) appears in Quicksand font (rounded, friendly letterforms) -- compare with Dashboard text which should still be in the regular font
6. Navigate to "/" (Dashboard) and verify NO visual changes -- Quicksand is trail-only
7. Test reduced motion:
   - Open browser DevTools -> Rendering -> check "Emulate CSS prefers-reduced-motion: reduce"
   - Verify stars are static (no twinkling animation)
   - Uncheck the setting and verify stars resume twinkling
  </how-to-verify>
  <resume-signal>Type "approved" if the enchanted forest background looks good, or describe any visual issues to fix.</resume-signal>
</task>

</tasks>

<verification>
1. Trail page shows enchanted forest gradient background (deep purple/navy, not flat slate)
2. 20 stars twinkle with varied timing across the page
3. Ambient glow orbs visible at bottom (purple, blue, green)
4. Trail page text renders in Quicksand font
5. Dashboard and other pages are visually unchanged
6. Stars stop animating when prefers-reduced-motion is enabled
7. `npm run build` passes with zero errors
</verification>

<success_criteria>
- Trail page displays enchanted forest background with multi-layer gradients and ambient glow orbs
- CSS animations respect reducedMotion (both media query and AccessibilityContext)
- Quicksand font renders on trail page only, other pages unaffected
- trail-effects.css imported and providing CSS classes
- Build passes, no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/19-css-foundation-font-setup/19-02-SUMMARY.md`
</output>
