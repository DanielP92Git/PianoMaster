---
phase: 19-css-foundation-font-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tailwind.config.js
  - src/main.jsx
  - src/styles/trail-effects.css
autonomous: true

must_haves:
  truths:
    - "Quicksand font is available as Tailwind utility class font-quicksand"
    - "Trail-specific CSS custom properties exist for glow colors and glass styling"
    - "Reusable CSS classes exist for 3D nodes, glass panels, glow effects, and animated starfield"
    - "Every CSS animation has both prefers-reduced-motion media query AND .reduced-motion class overrides"
    - "Box-shadow transitions use pseudo-element + opacity pattern (not direct box-shadow animation)"
    - "will-change is only applied on hover/active states, never statically on all nodes"
  artifacts:
    - path: "src/styles/trail-effects.css"
      provides: "Trail-scoped CSS module with custom properties, utility classes, keyframes, and reduced-motion overrides"
      min_lines: 150
    - path: "tailwind.config.js"
      provides: "Quicksand font family, cyan-glow/purple-glow colors, trail shadow utilities"
      contains: "quicksand"
    - path: "src/main.jsx"
      provides: "Quicksand font weight imports (400, 600, 700)"
      contains: "@fontsource/quicksand"
  key_links:
    - from: "src/main.jsx"
      to: "@fontsource/quicksand"
      via: "CSS import statements"
      pattern: "import '@fontsource/quicksand"
    - from: "tailwind.config.js"
      to: "Quicksand font"
      via: "fontFamily.quicksand config"
      pattern: "quicksand.*Quicksand"
    - from: "src/styles/trail-effects.css"
      to: "CSS custom properties"
      via: "var() references in utility classes"
      pattern: "var\\(--trail-"
---

<objective>
Install Quicksand font, extend Tailwind configuration with trail-specific utilities, and create the trail-effects.css module containing all reusable CSS classes, keyframes, and accessibility overrides for the enchanted forest visual redesign.

Purpose: Establish the CSS foundation that Phase 20+ components will consume. All visual effect patterns (3D nodes, glass panels, glow effects, starfield) are defined once here and reused across trail components.

Output: Three modified/created files providing the complete CSS toolkit for the trail page redesign.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/trail-visual-redesign/STACK.md
@.planning/research/trail-visual-redesign/PITFALLS.md
@tailwind.config.js
@src/main.jsx
@src/contexts/AccessibilityContext.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Quicksand Font and Extend Tailwind Config</name>
  <files>tailwind.config.js, src/main.jsx</files>
  <action>
1. Install the Quicksand font package:
   ```
   npm install @fontsource/quicksand
   ```

2. Add Quicksand font imports to `src/main.jsx` AFTER the existing Assistant font imports (line 43) and BEFORE the React imports (line 45). Add these 3 imports:
   ```javascript
   // Quicksand: Rounded kid-friendly font for trail page (font-quicksand)
   import '@fontsource/quicksand/400.css';
   import '@fontsource/quicksand/600.css';
   import '@fontsource/quicksand/700.css';
   ```

3. Extend `tailwind.config.js` with trail-specific additions. Add to the `extend` object:

   a. In `fontFamily` (after existing `hebrew` entry):
   ```javascript
   quicksand: ['Quicksand', 'Nunito', 'sans-serif'],
   ```
   Note: Nunito is the fallback because it's already loaded and has similar rounded aesthetic.

   b. In `colors` (after existing `highContrast` object), add:
   ```javascript
   trail: {
     'cyan-glow': '#00f2ff',
     'purple-glow': '#aa00ff',
     'forest-base': '#0f172a',
     'forest-mid': '#1a1040',
     'forest-accent': '#2d1b69',
   },
   ```

   c. In `boxShadow` (after existing `2xl` entry), add:
   ```javascript
   'node-3d': '0 6px 0 #009eb3, 0 10px 20px rgba(0, 242, 255, 0.4)',
   'node-3d-pressed': '0 2px 0 #009eb3, 0 5px 10px rgba(0, 242, 255, 0.4)',
   'glow-cyan': '0 0 20px rgba(0, 242, 255, 0.6)',
   'glow-purple': '0 0 15px rgba(147, 51, 234, 0.5)',
   ```

   d. In `extend`, add a new `dropShadow` object:
   ```javascript
   dropShadow: {
     'glow-cyan': '0 0 8px #00FFFF',
     'glow-purple': '0 0 6px #aa00ff',
   },
   ```

Do NOT modify any existing entries. Only ADD new entries.
  </action>
  <verify>
1. Run `npm ls @fontsource/quicksand` and confirm package is installed
2. Run `npm run build` and confirm zero build errors
3. Verify `tailwind.config.js` contains `quicksand`, `trail`, `node-3d`, `glow-cyan`, `dropShadow` entries
4. Verify `src/main.jsx` contains three `@fontsource/quicksand` import lines
  </verify>
  <done>
Quicksand font installed and importable. Tailwind config extended with font-quicksand class, trail color palette, 3D shadow utilities, and drop-shadow utilities. Build passes with zero errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create trail-effects.css Module</name>
  <files>src/styles/trail-effects.css</files>
  <action>
Create a new directory `src/styles/` and file `src/styles/trail-effects.css`. This file is the trail-scoped CSS module. It must NOT be imported globally -- it will be imported only by TrailMapPage.jsx (in Plan 02).

The file must contain ALL of the following sections in order:

**Section 1: CSS Custom Properties (scoped to .trail-page)**
```css
.trail-page {
  --trail-primary-glow: #00f2ff;
  --trail-secondary-glow: #aa00ff;
  --trail-glass-bg: rgba(255, 255, 255, 0.1);
  --trail-glass-border: rgba(255, 255, 255, 0.2);
  --trail-node-active-start: #4facfe;
  --trail-node-active-end: #00f2fe;
  --trail-node-locked-start: rgba(100, 80, 150, 0.6);
  --trail-node-locked-end: rgba(50, 40, 80, 0.8);
  --trail-node-completed-start: #4ade80;
  --trail-node-completed-end: #16a34a;
  --trail-forest-base: #0f172a;
  --trail-forest-mid: #1a1040;
  --trail-forest-accent: #2d1b69;
}
```

**Section 2: Enchanted Forest Background**
Create `.trail-forest-bg` class with:
- Multi-layer gradient: `background: linear-gradient(180deg, var(--trail-forest-base) 0%, var(--trail-forest-mid) 40%, var(--trail-forest-base) 100%)`
- Two radial gradient overlays (max 2 per PITFALLS.md Pitfall 6) using `::before` pseudo-element:
  - Purple glow: `radial-gradient(ellipse at 30% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%)`
  - Blue glow: `radial-gradient(ellipse at 70% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%)`
- The pseudo-element should use `position: absolute; inset: 0; pointer-events: none; z-index: 0;`

**Section 3: Ambient Glow Orbs**
Create `.trail-glow-orb` base class and variants:
```css
.trail-glow-orb {
  position: absolute;
  border-radius: 9999px;
  pointer-events: none;
  z-index: 1;
}
.trail-glow-orb--purple {
  background: rgba(139, 92, 246, 0.4);
  filter: blur(20px);
}
.trail-glow-orb--blue {
  background: rgba(59, 130, 246, 0.35);
  filter: blur(30px);
}
.trail-glow-orb--green {
  background: rgba(74, 222, 128, 0.3);
  filter: blur(25px);
}
```

**Section 4: Starfield Animation**
Create `@keyframes trail-twinkle` that animates opacity from 0.1 to 0.7 and back. Use a smooth easing.

Create `.trail-star` class with:
- `position: absolute; border-radius: 9999px; background: white;`
- `animation: trail-twinkle var(--star-duration, 3s) var(--star-delay, 0s) ease-in-out infinite;`

Add reduced-motion overrides (BOTH required per Pitfall 5):
```css
@media (prefers-reduced-motion: reduce) {
  .trail-star {
    animation: none;
    opacity: 0.4;
  }
}
.reduced-motion .trail-star {
  animation: none;
  opacity: 0.4;
}
```

**Section 5: Glass Panel**
Create `.trail-glass-panel` class matching the Stitch reference:
```css
.trail-glass-panel {
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid var(--trail-glass-border);
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
  border-radius: 1rem;
}
```
Add `@supports` fallback for browsers without backdrop-filter:
```css
@supports not (backdrop-filter: blur(12px)) {
  .trail-glass-panel {
    background: rgba(30, 20, 60, 0.95);
  }
}
```

**Section 6: 3D Node Styles**
Create these node classes following Pitfall 2 (pseudo-element + opacity for shadow transitions):

`.node-3d-active` -- Cyan/blue radial gradient, layered box-shadows for 3D depth, cyan border. Add `::before` pseudo-element with the glow shadow (opacity: 0, transition: opacity 200ms). On `:hover::before`, set opacity: 0.8. On `:active`, add `transform: translateY(4px)` with reduced shadow.

`.node-3d-locked` -- Dark purple radial gradient, subtle shadows, muted border. No hover glow effect.

`.node-3d-completed` -- Green radial gradient from `--trail-node-completed-start` to `--trail-node-completed-end`, green shadow depth, green border. Add glow pulse animation on `::after` pseudo-element.

`.node-3d-available` -- Similar to active but with a subtle breathing/pulse glow to draw attention.

IMPORTANT for all node classes:
- Static box-shadows only (no `transition: box-shadow` -- Pitfall 2)
- Glow effects via pseudo-element `::before`/`::after` with `opacity` transition only
- `will-change` ONLY on `:hover` state, not on the base class (Pitfall 10)
- All animated pseudo-elements need reduced-motion overrides

**Section 7: Glow Pulse Keyframe**
Create `@keyframes trail-glow-pulse` for the completed node glow:
```css
@keyframes trail-glow-pulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 0.8; }
}
```
Add BOTH reduced-motion overrides:
```css
@media (prefers-reduced-motion: reduce) {
  .node-3d-completed::after,
  .node-3d-available::before {
    animation: none;
    opacity: 0.5;
  }
}
.reduced-motion .node-3d-completed::after,
.reduced-motion .node-3d-available::before {
  animation: none;
  opacity: 0.5;
}
```

**Section 8: Text Glow Utilities**
```css
.text-glow-cyan {
  text-shadow: 0 0 10px rgba(0, 242, 255, 0.6);
}
.text-glow-purple {
  text-shadow: 0 0 10px rgba(170, 0, 255, 0.5);
}
.text-shadow-deep {
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}
```

**Section 9: SVG Path Glow**
```css
.path-svg-glow {
  filter: drop-shadow(0 0 4px var(--trail-primary-glow));
}
.path-svg-glow--completed {
  filter: drop-shadow(0 0 6px rgba(74, 222, 128, 0.6));
}
```

**Performance constraints to follow in all CSS:**
- PERF-01b: `will-change` only on `:hover`/`:active` states, never on base class
- PERF-01c: No `transition: box-shadow`. Only `opacity` and `transform` are animated
- Backdrop-filter limited to `.trail-glass-panel` only (max 3 elements on page)
- Radial gradients: max 2 layers for background (Section 2)
  </action>
  <verify>
1. Verify `src/styles/trail-effects.css` exists and has all 9 sections
2. Count `@media (prefers-reduced-motion: reduce)` occurrences -- must be at least 2 (starfield + glow pulse)
3. Count `.reduced-motion` class overrides -- must match the prefers-reduced-motion count
4. Grep for `transition.*box-shadow` -- must find ZERO occurrences (PERF-01c)
5. Grep for `will-change` without `:hover` or `:active` context -- must find ZERO occurrences on base classes (PERF-01b)
6. Run `npm run build` to confirm CSS is valid (no syntax errors)
  </verify>
  <done>
trail-effects.css module created with all 9 sections: CSS custom properties scoped to .trail-page, enchanted forest background, ambient glow orbs, animated starfield with reduced-motion overrides, glass panel with @supports fallback, 4 node state classes using pseudo-element opacity pattern, glow pulse keyframe with reduced-motion overrides, text glow utilities, and SVG path glow utilities. Zero box-shadow transitions. will-change only on hover. Both prefers-reduced-motion AND .reduced-motion overrides on every animation.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. `npm ls @fontsource/quicksand` shows package installed
3. `src/styles/trail-effects.css` exists with 150+ lines
4. Every `@keyframes` in trail-effects.css has matching `@media (prefers-reduced-motion: reduce)` AND `.reduced-motion` override
5. Zero `transition: box-shadow` patterns in trail-effects.css
6. Zero static `will-change` on base node classes (only on :hover/:active)
7. `tailwind.config.js` contains `quicksand`, `trail`, `node-3d`, `glow-cyan`, `dropShadow` additions
8. `src/main.jsx` has 3 Quicksand import lines after existing font imports
</verification>

<success_criteria>
- Quicksand font installed via @fontsource and importable as `font-quicksand` Tailwind class
- Tailwind config extended with trail colors, shadows, and drop-shadows
- trail-effects.css provides complete CSS toolkit: forest background, glow orbs, starfield, glass panel, 4 node states, text glows, path glows
- ALL animations have dual reduced-motion overrides (media query + class)
- Performance patterns enforced: pseudo-element opacity for shadows, no box-shadow transitions, will-change only on hover
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/19-css-foundation-font-setup/19-01-SUMMARY.md`
</output>
