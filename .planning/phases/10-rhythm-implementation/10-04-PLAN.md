---
phase: 10-rhythm-implementation
plan: 04
type: execute
wave: 2
depends_on: ["10-01", "10-02", "10-03"]
files_modified:
  - src/data/expandedNodes.js
autonomous: true

must_haves:
  truths:
    - "All 42 rhythm nodes appear in EXPANDED_NODES array"
    - "EXPANDED_RHYTHM_NODES export contains all 6 redesigned units"
    - "Legacy generateRhythmUnit calls removed from expandedNodes.js"
    - "Trail validation passes with all rhythm nodes"
  artifacts:
    - path: "src/data/expandedNodes.js"
      provides: "Unified node export with redesigned rhythm units"
      exports: ["EXPANDED_NODES", "EXPANDED_RHYTHM_NODES"]
      contains: "rhythmUnit1Nodes"
  key_links:
    - from: "src/data/expandedNodes.js"
      to: "src/data/units/rhythmUnit1Redesigned.js"
      via: "import statement"
      pattern: "import.*rhythmUnit1Nodes.*from.*units/rhythmUnit1Redesigned"
    - from: "src/data/expandedNodes.js"
      to: "src/data/units/rhythmUnit6Redesigned.js"
      via: "import statement"
      pattern: "import.*rhythmUnit6Nodes.*from.*units/rhythmUnit6Redesigned"
---

<objective>
Integrate all 42 redesigned rhythm nodes into expandedNodes.js

Purpose: Replace legacy rhythm generator imports with redesigned unit imports, unifying all trail content under the new pedagogical structure.

Output: Updated expandedNodes.js with all 6 rhythm units imported and exported, legacy rhythm generation removed
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-rhythm-implementation/10-CONTEXT.md

# Current state of expandedNodes.js (has legacy rhythm imports)
@src/data/expandedNodes.js

# Summary of prior integration pattern (Phase 9)
@.planning/phases/09-bass-clef-implementation/09-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update expandedNodes.js with redesigned rhythm imports</name>
  <files>src/data/expandedNodes.js</files>
  <action>
Modify expandedNodes.js to:

**1. Remove legacy rhythm imports:**
Delete or comment out:
```javascript
// Legacy rhythm generator (rhythm will be redesigned in Phase 10)
import { generateRhythmUnit } from '../utils/nodeGenerator.js';
```

Delete the legacy rhythm unit generation calls:
```javascript
// DELETE these:
const rhythmUnit1 = generateRhythmUnit({...});
const rhythmUnit2 = generateRhythmUnit({...});
```

**2. Add redesigned rhythm unit imports:**
After the bass clef imports, add:
```javascript
// Redesigned rhythm units
import rhythmUnit1Nodes from './units/rhythmUnit1Redesigned.js';
import rhythmUnit2Nodes from './units/rhythmUnit2Redesigned.js';
import rhythmUnit3Nodes from './units/rhythmUnit3Redesigned.js';
import rhythmUnit4Nodes from './units/rhythmUnit4Redesigned.js';
import rhythmUnit5Nodes from './units/rhythmUnit5Redesigned.js';
import rhythmUnit6Nodes from './units/rhythmUnit6Redesigned.js';
```

**3. Update EXPANDED_NODES array:**
Replace the rhythm spread operators:
```javascript
export const EXPANDED_NODES = [
  // Redesigned treble clef units (Units 1-3)
  ...trebleUnit1Nodes,
  ...trebleUnit2Nodes,
  ...trebleUnit3Nodes,

  // Redesigned bass clef units (Units 1-3)
  ...bassUnit1Nodes,
  ...bassUnit2Nodes,
  ...bassUnit3Nodes,

  // Redesigned rhythm units (Units 1-6)
  ...rhythmUnit1Nodes,
  ...rhythmUnit2Nodes,
  ...rhythmUnit3Nodes,
  ...rhythmUnit4Nodes,
  ...rhythmUnit5Nodes,
  ...rhythmUnit6Nodes
];
```

**4. Update EXPANDED_RHYTHM_NODES export:**
```javascript
export const EXPANDED_RHYTHM_NODES = [
  ...rhythmUnit1Nodes,
  ...rhythmUnit2Nodes,
  ...rhythmUnit3Nodes,
  ...rhythmUnit4Nodes,
  ...rhythmUnit5Nodes,
  ...rhythmUnit6Nodes
];
```

**5. Simplify linkUnitPrerequisites:**
Since redesigned rhythm units have prerequisites set in their files, the linkUnitPrerequisites function can be simplified. Remove the legacy rhythm linking logic:
```javascript
// DELETE this section:
// Link Rhythm Unit 2 to Unit 1 boss (legacy rhythm units still need this)
const rhythmUnit2Start = updatedNodes.find(n => n.id === 'rhythm_2_1');
if (rhythmUnit2Start) {
  rhythmUnit2Start.prerequisites = ['boss_rhythm_1'];
}
```

The function can now just return the nodes unchanged:
```javascript
export const linkUnitPrerequisites = (nodes) => {
  // Prerequisites are now set in redesigned unit files
  // No runtime linking needed
  return [...nodes];
};
```

**6. Update file header comment:**
```javascript
/**
 * Expanded Trail Nodes - Fully Redesigned System
 *
 * Educational psychology-driven trail system for 8-year-old learners.
 *
 * Treble Units 1-3: Redesigned (C4 to C5)
 * Bass Units 1-3: Redesigned (C4 to C3)
 * Rhythm Units 1-6: Redesigned (quarter notes to sixteenths)
 *
 * All units follow consistent NODE_TYPES pattern with pedagogical scaffolding.
 */
```
  </action>
  <verify>
1. Import statements: `grep -c "rhythmUnit.*Redesigned" src/data/expandedNodes.js` returns 6
2. No legacy generator: `grep -q "generateRhythmUnit" src/data/expandedNodes.js` returns false (exit code 1)
3. All rhythm spreads: `grep -c "...rhythmUnit.*Nodes" src/data/expandedNodes.js` returns 6
4. Export exists: `grep -q "EXPANDED_RHYTHM_NODES" src/data/expandedNodes.js`
5. File loads without error: `node -e "require('./src/data/expandedNodes.js')"`
  </verify>
  <done>
expandedNodes.js imports all 6 redesigned rhythm units, removes legacy generator import, spreads all rhythm nodes into EXPANDED_NODES and EXPANDED_RHYTHM_NODES
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate complete rhythm integration</name>
  <files></files>
  <action>
Run validation to confirm all rhythm nodes are properly integrated:

**1. Run trail validation script:**
```bash
npm run verify:trail
```
Expected: All 42 rhythm nodes + treble + bass nodes validated without errors

**2. Run build to catch import errors:**
```bash
npm run build
```
Expected: Build succeeds without errors

**3. Verify node count:**
Create a quick verification script or run in Node REPL:
```javascript
const { EXPANDED_NODES, EXPANDED_RHYTHM_NODES } = require('./src/data/expandedNodes.js');
console.log('Total nodes:', EXPANDED_NODES.length);
console.log('Rhythm nodes:', EXPANDED_RHYTHM_NODES.length);
// Expected rhythm: 42 (6 units × 7 nodes)
// Expected total: ~63 treble + bass + 42 rhythm = ~105 (verify actual)
```

**4. Verify prerequisite chain:**
Check that rhythm unit prerequisite chain is complete:
- rhythm_2_1 requires boss_rhythm_1
- rhythm_3_1 requires boss_rhythm_2
- rhythm_4_1 requires boss_rhythm_3
- rhythm_5_1 requires boss_rhythm_4
- rhythm_6_1 requires boss_rhythm_5

```bash
grep -h "prerequisites.*boss_rhythm" src/data/units/rhythmUnit*Redesigned.js
```

**5. Verify XP progression:**
Check that XP increases across units:
```bash
grep "xpReward:" src/data/units/rhythmUnit*Redesigned.js | tail -20
```
Expected: Boss XP increases (100 -> 110 -> 120 -> 130 -> 140 -> 200)
  </action>
  <verify>
1. Trail validation: `npm run verify:trail` completes without errors
2. Build: `npm run build` succeeds
3. Node count: EXPANDED_RHYTHM_NODES.length === 42
4. No orphaned nodes (all prerequisites can be resolved)
5. XP progression verified
  </verify>
  <done>
Trail validation passes with all 42 rhythm nodes, build succeeds, prerequisite chains verified, XP progression correct across 6 units
  </done>
</task>

</tasks>

<verification>
Run after all tasks complete:

1. Complete trail validation:
```bash
npm run verify:trail
```

2. Full build:
```bash
npm run build
```

3. Check total node counts:
```bash
node -e "const n = require('./src/data/expandedNodes.js'); console.log('Total:', n.EXPANDED_NODES.length, 'Treble:', n.EXPANDED_TREBLE_NODES.length, 'Bass:', n.EXPANDED_BASS_NODES.length, 'Rhythm:', n.EXPANDED_RHYTHM_NODES.length)"
```

4. Verify no legacy generator remains:
```bash
grep -c "generateRhythmUnit" src/data/expandedNodes.js
# Should be 0
```

5. List all rhythm boss nodes to verify chain:
```bash
grep -h "id: 'boss_rhythm" src/data/units/rhythmUnit*Redesigned.js
# Should show boss_rhythm_1 through boss_rhythm_6
```
</verification>

<success_criteria>
1. expandedNodes.js imports all 6 redesigned rhythm unit files
2. Legacy generateRhythmUnit import removed
3. Legacy rhythmUnit1/rhythmUnit2 generator calls removed
4. EXPANDED_NODES contains all 42 rhythm nodes
5. EXPANDED_RHYTHM_NODES export contains all 6 units spread
6. linkUnitPrerequisites simplified (no runtime rhythm linking)
7. npm run verify:trail passes
8. npm run build succeeds
9. Node count: 42 rhythm nodes (6 units × 7 nodes each)
10. Full trail ready for Phase 11 (Integration & Cutover)
</success_criteria>

<output>
After completion, create `.planning/phases/10-rhythm-implementation/10-04-SUMMARY.md`
</output>
