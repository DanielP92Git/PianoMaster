---
phase: 04-platform-specific-android-enhancement
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/games/notes-master-games/NotesRecognitionGame.jsx
  - src/components/games/notes-master-games/MemoryGame.jsx
  - src/components/games/rhythm-games/MetronomeTrainer.jsx
  - src/components/games/sight-reading-game/SightReadingGame.jsx
autonomous: false

must_haves:
  truths:
    - "All 4 game components call useLandscapeLock on mount"
    - "On Android PWA, entering any game triggers fullscreen + landscape lock"
    - "On Android PWA, navigating away from a game (Back to Trail, dashboard) unlocks orientation and exits fullscreen"
    - "On iOS, users see the rotate prompt instead of orientation lock (no API lock attempt)"
    - "Orientation lock covers full game lifecycle from settings modal through victory screen"
    - "Feature detection prevents errors when Screen Orientation API is unavailable"
  artifacts:
    - path: "src/components/games/notes-master-games/NotesRecognitionGame.jsx"
      provides: "Notes recognition game with landscape lock"
      contains: "useLandscapeLock"
    - path: "src/components/games/notes-master-games/MemoryGame.jsx"
      provides: "Memory game with landscape lock"
      contains: "useLandscapeLock"
    - path: "src/components/games/rhythm-games/MetronomeTrainer.jsx"
      provides: "Metronome trainer with landscape lock"
      contains: "useLandscapeLock"
    - path: "src/components/games/sight-reading-game/SightReadingGame.jsx"
      provides: "Sight reading game with landscape lock"
      contains: "useLandscapeLock"
  key_links:
    - from: "src/components/games/notes-master-games/NotesRecognitionGame.jsx"
      to: "src/hooks/useLandscapeLock.js"
      via: "import and hook call"
      pattern: "import.*useLandscapeLock"
    - from: "src/components/games/notes-master-games/MemoryGame.jsx"
      to: "src/hooks/useLandscapeLock.js"
      via: "import and hook call"
      pattern: "import.*useLandscapeLock"
    - from: "src/components/games/rhythm-games/MetronomeTrainer.jsx"
      to: "src/hooks/useLandscapeLock.js"
      via: "import and hook call"
      pattern: "import.*useLandscapeLock"
    - from: "src/components/games/sight-reading-game/SightReadingGame.jsx"
      to: "src/hooks/useLandscapeLock.js"
      via: "import and hook call"
      pattern: "import.*useLandscapeLock"
---

<objective>
Integrate `useLandscapeLock` into all 4 game components and verify the complete orientation lock feature on an Android device.

Purpose: Connect the hook created in Plan 04-01 to every game entry point so Android PWA users get automatic landscape locking across all game modes. Human verification ensures the feature works correctly on a real Android device.

Output: All 4 game components using landscape lock, verified on Android.
</objective>

<execution_context>
@C:/Users/pagis/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/pagis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-platform-specific-android-enhancement/04-01-SUMMARY.md
@src/hooks/useLandscapeLock.js
@src/components/games/notes-master-games/NotesRecognitionGame.jsx
@src/components/games/notes-master-games/MemoryGame.jsx
@src/components/games/rhythm-games/MetronomeTrainer.jsx
@src/components/games/sight-reading-game/SightReadingGame.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add useLandscapeLock to all 4 game components</name>
  <files>
    src/components/games/notes-master-games/NotesRecognitionGame.jsx
    src/components/games/notes-master-games/MemoryGame.jsx
    src/components/games/rhythm-games/MetronomeTrainer.jsx
    src/components/games/sight-reading-game/SightReadingGame.jsx
  </files>
  <action>
Add `useLandscapeLock` to each of the 4 game components. For each file:

1. **Add import** — Place the import near the existing `useRotatePrompt` import:
   ```javascript
   import { useLandscapeLock } from "../../../hooks/useLandscapeLock";
   ```
   For SightReadingGame.jsx, the relative path is also `"../../../hooks/useLandscapeLock"`.

2. **Add hook call** — Place `useLandscapeLock();` right BEFORE the existing `useRotatePrompt()` call in the component function body. The hook takes no parameters and returns nothing. Example placement:

   ```javascript
   // Android PWA: fullscreen + orientation lock
   useLandscapeLock();

   // iOS/non-PWA: rotate prompt overlay
   const { shouldShowPrompt, dismissPrompt } = useRotatePrompt();
   ```

The exact files and their existing `useRotatePrompt` call locations:
- **NotesRecognitionGame.jsx** line ~431: `const { shouldShowPrompt, dismissPrompt } = useRotatePrompt();`
- **MemoryGame.jsx** line ~68: `const { shouldShowPrompt, dismissPrompt } = useRotatePrompt();`
- **MetronomeTrainer.jsx** line ~101: `const { shouldShowPrompt, dismissPrompt } = useRotatePrompt();`
- **SightReadingGame.jsx** line ~153: `const { shouldShowPrompt, dismissPrompt } = useRotatePrompt();`

Do NOT change any other code in the game components. Do NOT modify the RotatePromptOverlay JSX — it is still needed for iOS users and will be naturally suppressed on Android PWA by the updated `useRotatePrompt` from Plan 04-01.

Run `npm run build` after all changes to confirm no import errors or build failures.
  </action>
  <verify>
For each of the 4 game files, verify:
- `import { useLandscapeLock }` line exists
- `useLandscapeLock();` call exists before `useRotatePrompt()`
- No other changes to the file

Run: `npm run build` passes without errors.
Run: `npx vitest run --passWithNoTests` passes without regressions.
  </verify>
  <done>
All 4 game components import and call `useLandscapeLock()`. Build passes. No test regressions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify landscape lock on Android PWA</name>
  <files>no files — human verification only</files>
  <action>
WHAT WAS BUILT: Android PWA landscape lock feature — when entering any game on an Android PWA, the device enters fullscreen and locks to landscape orientation. When navigating away (Back to Trail/dashboard), fullscreen exits and orientation unlocks. On iOS, the rotate prompt continues to show instead.

HOW TO VERIFY:

Prerequisites: Deploy to a testable URL (`npm run build` + deploy or use `npm run dev` with ngrok/local network).

Android PWA Testing (primary):
1. Open the app as an installed PWA on an Android device
2. Navigate to any game (e.g., Notes Recognition from the trail)
3. Verify: Device enters fullscreen and locks to landscape orientation
4. Play through or use settings — verify landscape persists throughout
5. Click "Back to Trail" or navigate away — verify orientation unlocks and fullscreen exits
6. Repeat for at least one other game mode (e.g., Metronome Trainer)
7. Try pressing Escape/Back while in fullscreen game — verify orientation unlocks

iOS Testing (fallback verification):
1. Open the app on an iOS device (Safari or installed PWA)
2. Navigate to a game in portrait mode
3. Verify: Rotate prompt appears (NOT fullscreen/lock behavior)
4. Verify: Dismissing prompt works as before

Desktop Testing (no-op verification):
1. Open the app in desktop Chrome
2. Navigate to a game
3. Verify: No fullscreen or orientation lock occurs
  </action>
  <verify>Type "approved" to continue, or describe any issues found.</verify>
  <done>Human has verified that Android PWA landscape lock works correctly, iOS falls back to rotate prompt, and desktop is unaffected.</done>
</task>

</tasks>

<verification>
1. All 4 game files contain `useLandscapeLock()` import and call
2. `npm run build` passes without errors
3. `npx vitest run --passWithNoTests` passes
4. Android PWA: games enter fullscreen + landscape lock
5. Android PWA: navigating away unlocks orientation + exits fullscreen
6. iOS: rotate prompt shown instead of API lock
7. Desktop: no fullscreen or orientation lock
8. Escape key during game exits fullscreen and unlocks orientation
</verification>

<success_criteria>
- All 4 game components call useLandscapeLock on mount
- Android PWA auto-locks to landscape in games, auto-unlocks on navigation
- iOS gracefully falls back to rotate prompt
- Desktop is unaffected
- Human verification confirms feature works on real Android device
</success_criteria>

<output>
After completion, create `.planning/phases/04-platform-specific-android-enhancement/04-02-SUMMARY.md`
</output>
