---
phase: 20-component-integration-tab-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/trail/TrailNode.jsx
  - src/styles/trail-effects.css
autonomous: true

must_haves:
  truths:
    - "Trail nodes display 3D depth effects with radial gradients and layered box-shadows"
    - "Active/current node has a static cyan glow ring (no pulse animation)"
    - "Completed nodes show gold stars inside the node circle (replacing the icon)"
    - "Locked nodes display as dark silhouettes with a lock icon overlay"
    - "Node press animation provides tactile feedback (translateY ~2px with reduced shadow)"
    - "Desktop hover scales node up ~10% with enhanced glow"
    - "Locked nodes show a tooltip on tap explaining what to complete first"
  artifacts:
    - path: "src/components/trail/TrailNode.jsx"
      provides: "3D-styled trail node with state-based CSS classes and tooltip"
      contains: "node-3d-"
    - path: "src/styles/trail-effects.css"
      provides: "CSS tooltip styles for locked nodes"
      contains: "locked-tooltip"
  key_links:
    - from: "src/components/trail/TrailNode.jsx"
      to: "src/styles/trail-effects.css"
      via: "CSS class application"
      pattern: "node-3d-(active|locked|completed|available|mastered)"
---

<objective>
Apply Phase 19 CSS foundation to TrailNode component: 3D node styling with visual state distinction, stars inside completed nodes, locked node silhouettes with tooltips, active node cyan glow ring, and press/hover interaction feedback.

Purpose: Transform flat trail nodes into game-like 3D buttons with clear visual state feedback, matching the enchanted forest theme.
Output: Updated TrailNode.jsx using node-3d-* CSS classes, with tooltip support for locked nodes.
</objective>

<execution_context>
@C:/Users/pagis/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/pagis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/trail/TrailNode.jsx
@src/styles/trail-effects.css
@src/utils/nodeTypeStyles.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restyle TrailNode with 3D CSS classes and star overlays</name>
  <files>src/components/trail/TrailNode.jsx</files>
  <action>
Refactor TrailNode.jsx to use Phase 19's `.node-3d-*` CSS classes instead of inline Tailwind color/border/glow classes. This is a significant visual overhaul of the component.

**Node state mapping (from existing `nodeState` useMemo):**
- `locked` -> CSS class `node-3d-locked`
- `available` -> CSS class `node-3d-available`
- `current` -> CSS class `node-3d-active` (maps to active = cyan glow ring)
- `completed` -> CSS class `node-3d-completed`
- `mastered` -> CSS class `node-3d-completed` (same visual, stars differentiate)

**Replace the node button's Tailwind color classes** with the CSS class:
- Remove: `${colors.bg}`, `${colors.border}`, `${colors.glow}` from button className
- Add: `node-3d-${nodeState === 'current' ? 'active' : nodeState === 'mastered' ? 'completed' : nodeState}`
- Keep: `${sizeClass}`, `${isBoss ? 'rounded-full' : 'rounded-xl'}`, aria-label

**Press animation (LOCKED DECISION):** Gentle press-down dip on tap. The CSS classes already handle this:
- `.node-3d-active:active { transform: translateY(4px) }` -- change to `translateY(2px)` per user decision "~2px"
- Same for `.node-3d-completed:active` and `.node-3d-available:active`

**Hover (LOCKED DECISION):** Desktop hover scales up ~10% with enhanced glow.
- Keep existing `hover:scale-110` on unlocked nodes
- The CSS `::before` pseudo-element already enhances glow on hover via opacity transition

**Stars inside completed nodes (LOCKED DECISION):**
- When `isCompleted && stars > 0`: render 3 star SVGs inside the node circle using absolute positioning overlay, replacing the icon
- Stars: filled gold (`text-yellow-400`) with glow `drop-shadow-[0_0_3px_rgba(250,204,21,0.8)]` for earned stars
- Unfilled stars: `text-gray-600`
- Use `absolute inset-0 flex items-center justify-center gap-0.5` container
- Star size: `h-4 w-4` (fits inside 40-48px node circle)
- When `isCompleted && stars === 0`: keep showing the icon (rare edge case)

**Move stars from above-node to inside-node:**
- Remove the existing star display div above the button (the `mb-0.5 flex gap-0.5` container with 3 star SVGs)
- Stars now render INSIDE the button element as an overlay

**Active/current node cyan glow ring (LOCKED DECISION):**
- Static cyan glow ring, no pulse animation
- Do NOT use Tailwind ring utilities (contradicts "remove Tailwind colors" approach)
- Instead, the `.node-3d-active` CSS class in trail-effects.css will be updated (Task 2) to include a static cyan glow ring via `box-shadow` (an additional outer glow layer)
- No extra Tailwind classes needed — the CSS class handles everything
- The `node-3d-active` class already provides the cyan gradient background; Task 2 adds the static ring

**Locked node silhouette (LOCKED DECISION):**
- Content hidden: dark overlay covers the icon area
- Lock icon displayed centrally (use lucide-react `Lock` icon, size 18, white/60 color)
- Import `Lock` from lucide-react
- Replace the existing emoji padlock with proper icon
- Keep opacity-60 from CSS class `.node-3d-locked`

**Locked node tooltip (LOCKED DECISION):**
- Tapping a locked node shows a brief tooltip "Complete X first" (where X = prerequisite node name)
- Add `useState` for `showTooltip` boolean
- On locked node click: `setShowTooltip(true)`, then `setTimeout(() => setShowTooltip(false), 2000)`
- Tooltip positioned above node with absolute positioning
- Look up prerequisite name from `node.prerequisites` array -- get the first prerequisite's name for the message
- Use existing `getNodeById` from skillTrail.js to look up prerequisite name
- Tooltip styling: `bg-gray-900 px-3 py-1.5 text-xs text-white rounded-lg shadow-lg whitespace-nowrap`
- Position: `absolute -top-10 left-1/2 -translate-x-1/2`

**Preserve existing behavior:**
- Boss crown indicator stays
- Current indicator label ("Start Here" / "Continue") stays
- Node name and best score display stays
- onClick handler stays (unlocked or boss nodes)
- pulseClass from nodeTypeStyles remains for non-reducedMotion (but note: the node-3d-* classes have their own animations; the existing pulseClass from Tailwind may need to be removed to avoid conflict -- remove it since CSS classes handle glow animations)

**Do NOT change:**
- Props interface
- Node state calculation logic
- Translation keys
- Accessibility attributes (aria-label)
  </action>
  <verify>
Run `npm run build` to verify no compilation errors. Visually inspect that TrailNode imports are clean and the component renders without errors by checking `npm run dev` and navigating to /trail.
  </verify>
  <done>
TrailNode uses node-3d-* CSS classes for all visual states. Completed nodes show stars inside the circle. Locked nodes show lock icon overlay with tap-to-show tooltip. Active nodes have cyan glow ring. Press animation uses translateY(2px). Hover scales 10%.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update trail-effects.css for 2px press depth and tooltip styles</name>
  <files>src/styles/trail-effects.css</files>
  <action>
Make targeted updates to trail-effects.css:

1. **Change press depth from 4px to 2px** (LOCKED DECISION: "~2px"):
   - `.node-3d-active:active { transform: translateY(2px) }` (was 4px)
   - `.node-3d-completed:active { transform: translateY(2px) }` (was 4px)
   - `.node-3d-available:active { transform: translateY(2px) }` (was 4px)
   - Also adjust box-shadow offset: `0 4px 0` (was `0 2px 0`) since less travel = less shadow reduction
     Actually, with 2px translateY, the shadow should reduce by 2px: from `0 6px 0` to `0 4px 0`

1b. **Add static cyan glow ring to `.node-3d-active`** (LOCKED DECISION: static cyan glow, no pulse):
   - Add an additional outer box-shadow layer to `.node-3d-active` for the glow ring:
     ```css
     .node-3d-active {
       box-shadow:
         0 0 0 3px rgba(0, 242, 255, 0.6),   /* Static cyan glow ring */
         0 6px 0 #009eb3,
         0 10px 20px rgba(0, 242, 255, 0.4);
     }
     ```
   - Also update the `:active` state's box-shadow to keep the ring:
     ```css
     .node-3d-active:active {
       box-shadow:
         0 0 0 3px rgba(0, 242, 255, 0.6),
         0 4px 0 #009eb3,
         0 5px 10px rgba(0, 242, 255, 0.4);
     }
     ```
   - This is a CSS-only solution — no Tailwind ring classes needed in TrailNode.jsx

2. **Add locked node tooltip styles** (new Section 10):
   ```css
   /* SECTION 10: Locked Node Tooltip */
   .locked-tooltip {
     position: absolute;
     bottom: calc(100% + 8px);
     left: 50%;
     transform: translateX(-50%);
     white-space: nowrap;
     z-index: 50;
     animation: tooltip-fade-in 150ms ease-out;
   }

   @keyframes tooltip-fade-in {
     from { opacity: 0; transform: translateX(-50%) translateY(4px); }
     to { opacity: 1; transform: translateX(-50%) translateY(0); }
   }
   ```

3. **Add mastered node variant** (optional distinction for 3-star completion):
   - `.node-3d-mastered` can extend `.node-3d-completed` -- but since we map mastered to completed in TrailNode, this is optional. Skip unless needed.

Do NOT modify Sections 1-5 (custom properties, forest background, glow orbs, starfield, glass panel) or Section 7-9 (glow pulse, text glow, SVG path glow).
  </action>
  <verify>
Run `npm run build` to verify CSS parses correctly. Check that the CSS file loads without errors in the browser (no console warnings about invalid CSS).
  </verify>
  <done>
Press animation uses 2px translateY across all node states. Tooltip fade-in animation added. CSS changes are minimal and targeted.
  </done>
</task>

</tasks>

<verification>
1. Navigate to /trail in dev mode -- nodes should display with 3D styling (gradients, shadows, glow effects)
2. Click a completed node -- should show gold stars inside the circle instead of icon
3. Click a locked node -- should show tooltip briefly then fade
4. Hover over unlocked node on desktop -- should scale up ~10%
5. Press/tap an unlocked node -- should dip down ~2px
6. Active/current node should have cyan glow ring (static, no pulse)
7. TrailNodeModal should still open correctly when clicking unlocked nodes
</verification>

<success_criteria>
- TrailNode renders with node-3d-* CSS classes for all 5 states
- Stars render inside completed node circles
- Locked nodes show silhouette + lock icon + tooltip on tap
- Press animation is subtle (2px translateY)
- No regression in node click -> modal flow
</success_criteria>

<output>
After completion, create `.planning/phases/20-component-integration-tab-navigation/20-01-SUMMARY.md`
</output>
