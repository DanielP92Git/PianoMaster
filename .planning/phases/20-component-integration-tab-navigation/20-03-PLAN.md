---
phase: 20-component-integration-tab-navigation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/TrailMapPage.jsx
autonomous: true

must_haves:
  truths:
    - "Trail header displays shield-style level badge with level number and level name"
    - "XP progress bar shows progress to next level in the header"
    - "Learning Trail title uses Quicksand font"
    - "Free Practice button is secondary/subtle (ghost button or text link)"
    - "Back navigation to Dashboard is present"
  artifacts:
    - path: "src/pages/TrailMapPage.jsx"
      provides: "Trail header with level badge, XP bar, title, navigation"
      contains: "Shield"
  key_links:
    - from: "src/pages/TrailMapPage.jsx"
      to: "src/utils/xpSystem.js"
      via: "getStudentXP query"
      pattern: "getStudentXP|getLevelProgress"
    - from: "src/pages/TrailMapPage.jsx"
      to: "lucide-react"
      via: "Shield icon import"
      pattern: "Shield"
---

<objective>
Redesign the trail page header with a shield-style level badge showing level number + name, an XP progress bar, "Learning Trail" title in Quicksand font, and subtle "Free Practice" navigation. Replace the existing compact XP display with a more prominent, motivating header layout.

Purpose: Keep level progress and motivation visible while browsing the trail. Kids connect with level names ("Adventurer") and seeing XP progress encourages continued play.
Output: Updated TrailMapPage.jsx with redesigned header section.
</objective>

<execution_context>
@C:/Users/pagis/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/pagis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/pages/TrailMapPage.jsx
@src/utils/xpSystem.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign trail header with level badge, XP bar, and navigation</name>
  <files>src/pages/TrailMapPage.jsx</files>
  <action>
Replace the existing navigation bar in TrailMapPage.jsx with a redesigned header. The header currently has: back link, title, compact XP display, Free Practice link.

**1. Add Shield icon import:**
```jsx
import { Shield } from 'lucide-react';
```

**2. Extract XP data from the existing `xpData` query result:**
The `getStudentXP` already returns `{ levelData, progress, totalXP }` where:
- `levelData` = `{ level, xpRequired, title, icon }` from `calculateLevel()`
- `progress` = `{ currentLevel, nextLevelXP, xpInCurrentLevel, xpNeededForNext, progressPercentage }` from `getLevelProgress()`

**3. Redesigned header layout (2-row design):**

**Row 1: Navigation + Title + Free Practice**
```jsx
<div className="flex items-center justify-between">
  <Link to="/" className="flex items-center gap-2 text-white/70 hover:text-white transition-colors">
    <span className="text-xl">{isRTL ? '\u2192' : '\u2190'}</span>
    <span className="font-medium text-sm">{t('common.dashboard', { defaultValue: 'Dashboard' })}</span>
  </Link>
  <h1 className="text-xl font-bold text-white font-quicksand">
    {t('pageTitle', { ns: 'trail' })}
  </h1>
  <Link
    to="/practice-modes"
    className="text-sm text-white/50 hover:text-white/80 transition-colors"
  >
    {t('freePracticeLink', { ns: 'trail' })}
  </Link>
</div>
```

- Free Practice is secondary/subtle (LOCKED DECISION): text-white/50 makes it a ghost/text link
- Title uses font-quicksand (LOCKED DECISION): Quicksand loaded in Phase 19

**Row 2: Level badge + XP progress bar**

Shield/emblem style level badge (LOCKED DECISION):
```jsx
<div className="flex items-center gap-3">
  {/* Shield badge */}
  <div className="flex items-center gap-2.5">
    <div className="relative">
      <Shield className="h-9 w-9 text-yellow-400" fill="rgba(250, 204, 21, 0.15)" strokeWidth={1.5} />
      {/* Level number centered inside shield */}
      <span className="absolute inset-0 flex items-center justify-center text-sm font-bold text-yellow-400 pt-0.5">
        {xpData?.levelData?.level || 1}
      </span>
    </div>
    <div className="flex flex-col">
      <span className="text-sm font-bold text-white leading-tight">
        {xpData?.levelData?.title || 'Beginner'}
      </span>
      <span className="text-[10px] text-white/50 leading-tight">
        {xpData?.progress?.xpInCurrentLevel || 0} / {xpData?.progress?.nextLevelXP
          ? xpData.progress.nextLevelXP - (xpData.progress.currentLevel?.xpRequired || 0)
          : 100} XP
      </span>
    </div>
  </div>

  {/* XP progress bar (LOCKED DECISION: small bar showing progress to next level) */}
  <div className="flex-1 h-2 bg-white/10 rounded-full overflow-hidden">
    <div
      className="h-full bg-gradient-to-r from-yellow-400 to-amber-500 rounded-full transition-all duration-500"
      style={{ width: `${xpData?.progress?.progressPercentage || 0}%` }}
    />
  </div>
</div>
```

Level number AND level name shown (LOCKED DECISION): "Level 4 -- Adventurer" pattern achieved by showing number inside shield + title next to it. The visual reads as shield(4) + "Melody Maker" which communicates both.

**4. Full header container:**
```jsx
<div className="relative z-10 border-b border-white/10 bg-slate-900/80 backdrop-blur-sm">
  <div className={`mx-auto max-w-6xl space-y-2.5 p-4 ${isRTL ? 'text-right' : ''}`}>
    {/* Row 1: Nav + Title + Free Practice */}
    {/* Row 2: Level badge + XP bar */}
  </div>
</div>
```

**5. Handle RTL:**
- Arrow direction already flipped via isRTL check
- flex-row-reverse for RTL layouts on nav row
- The existing RTL handling pattern should be preserved

**6. Handle loading state (no xpData yet):**
- Shield shows "1" as default level
- Title shows "Beginner" as default
- XP bar shows 0% width
- All values have fallback defaults with `|| 0` and `|| 'Beginner'`

**Do NOT change:**
- The rest of the page (enchanted starfield, glow orbs, TrailMap rendering)
- The xpData query configuration (queryKey, staleTime, enabled)
- The `trail-page trail-forest-bg` root classes
- The reduced-motion class application
  </action>
  <verify>
Run `npm run build` to verify compilation. Navigate to /trail in dev mode:
1. Header should show shield icon with level number inside
2. Level name displayed next to shield (e.g., "Beginner", "Music Sprout")
3. XP bar should show progress percentage
4. "Learning Trail" title uses Quicksand font
5. "Free Practice" link is subtle/ghost style
6. Back arrow navigates to dashboard
  </verify>
  <done>
Trail header displays shield-style level badge with number inside + level name beside it. XP progress bar shows current level progress. Title uses Quicksand font. Free Practice is a subtle text link. Navigation preserved with RTL support.
  </done>
</task>

</tasks>

<verification>
1. Navigate to /trail -- header shows 2-row layout with shield badge, XP bar, title, navigation
2. Level number appears inside the shield icon
3. Level name (e.g., "Beginner") appears next to shield
4. XP text shows "X / Y XP" format
5. XP bar width matches progress percentage
6. "Free Practice" link is subtle (white/50 opacity)
7. Click "Dashboard" -- navigates to /
8. Click "Free Practice" -- navigates to /practice-modes
9. Page still shows enchanted forest background, starfield, glow orbs
</verification>

<success_criteria>
- Shield icon with level number centered inside it
- Level name displayed prominently
- XP progress bar visible in header
- Quicksand font on title
- Subtle Free Practice link
- No regression in page layout or background effects
</success_criteria>

<output>
After completion, create `.planning/phases/20-component-integration-tab-navigation/20-03-SUMMARY.md`
</output>
