---
phase: 09-bass-clef-implementation
plan: 04
type: execute
wave: 2
depends_on: ["09-01", "09-02", "09-03"]
files_modified:
  - src/data/expandedNodes.js
autonomous: true

must_haves:
  truths:
    - "Bass clef units are integrated into the trail system"
    - "Legacy bass clef generator code is replaced with redesigned imports"
    - "All 25 bass clef nodes appear in EXPANDED_NODES array"
    - "Prerequisite chain links Unit 1 -> Unit 2 -> Unit 3 correctly"
  artifacts:
    - path: "src/data/expandedNodes.js"
      provides: "Integrated trail with redesigned bass units"
      contains: "import.*bassUnit1Nodes.*from.*bassUnit1Redesigned"
  key_links:
    - from: "src/data/expandedNodes.js"
      to: "src/data/units/bassUnit1Redesigned.js"
      via: "import statement"
      pattern: "import.*bassUnit1Nodes"
    - from: "src/data/expandedNodes.js"
      to: "src/data/units/bassUnit2Redesigned.js"
      via: "import statement"
      pattern: "import.*bassUnit2Nodes"
    - from: "src/data/expandedNodes.js"
      to: "src/data/units/bassUnit3Redesigned.js"
      via: "import statement"
      pattern: "import.*bassUnit3Nodes"
---

<objective>
Integrate the three redesigned bass clef units into expandedNodes.js, replacing the legacy generator-based bass units.

Purpose: Connect the new pedagogy-driven bass clef nodes to the main trail system. Remove dependency on legacy `generateUnit()` for bass clef while preserving rhythm units (which will be redesigned in Phase 10).

Output: Updated `expandedNodes.js` that imports and exports redesigned bass units.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-bass-clef-implementation/09-CONTEXT.md

# File to modify
@src/data/expandedNodes.js

# New unit files created in prior plans
@src/data/units/bassUnit1Redesigned.js
@src/data/units/bassUnit2Redesigned.js
@src/data/units/bassUnit3Redesigned.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update expandedNodes.js with redesigned bass imports</name>
  <files>src/data/expandedNodes.js</files>
  <action>
Modify `src/data/expandedNodes.js` to:

1. **Add new imports** (after treble imports, before legacy generator import):
```javascript
import bassUnit1Nodes from './units/bassUnit1Redesigned.js';
import bassUnit2Nodes from './units/bassUnit2Redesigned.js';
import bassUnit3Nodes from './units/bassUnit3Redesigned.js';
```

2. **Remove legacy bass unit generation** (delete these blocks):
```javascript
// DELETE: const bassUnit1 = generateUnit({...})
// DELETE: const bassUnit2 = generateUnit({...})
```

3. **Update EXPANDED_NODES** to use redesigned imports:
```javascript
export const EXPANDED_NODES = [
  // Redesigned treble clef units (Units 1-3)
  ...trebleUnit1Nodes,
  ...trebleUnit2Nodes,
  ...trebleUnit3Nodes,

  // Redesigned bass clef units (Units 1-3)
  ...bassUnit1Nodes,
  ...bassUnit2Nodes,
  ...bassUnit3Nodes,

  // Legacy rhythm units (to be redesigned in Phase 10)
  ...rhythmUnit1,
  ...rhythmUnit2
];
```

4. **Update EXPANDED_BASS_NODES** export:
```javascript
export const EXPANDED_BASS_NODES = [
  ...bassUnit1Nodes,
  ...bassUnit2Nodes,
  ...bassUnit3Nodes
];
```

5. **Simplify linkUnitPrerequisites** function:
- Remove the bass unit prerequisite linking code (now handled in unit files)
- Keep the rhythm unit prerequisite linking (still needed for legacy rhythm units)

**Keep unchanged:**
- Treble unit imports (already redesigned)
- Rhythm unit generation (Phase 10 work)
- NODE_CATEGORIES import

**File header update:**
```javascript
/**
 * Expanded Trail Nodes - Redesigned System
 *
 * Educational psychology-driven trail system for 8-year-old learners.
 *
 * Treble Units 1-3: Redesigned (C4 to C5, quarters + halves only)
 * Bass Units 1-3: Redesigned (C4 to C3, quarters + halves only)
 * Rhythm Units 1-2: Legacy generator (to be redesigned in Phase 10)
 *
 * This file imports the redesigned units and combines them.
 */
```
  </action>
  <verify>
1. Run `npm run verify:patterns` - should pass with no bass clef errors
2. Run `npm run build` - should build successfully
3. Check EXPANDED_NODES includes all 25 bass nodes (7 + 8 + 10)
  </verify>
  <done>
expandedNodes.js updated with:
- Imports for bassUnit1Nodes, bassUnit2Nodes, bassUnit3Nodes
- Legacy generateUnit() calls removed for bass clef
- EXPANDED_BASS_NODES uses redesigned arrays
- Build passes, validation passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate complete bass clef integration</name>
  <files>src/data/expandedNodes.js</files>
  <action>
Run comprehensive validation to ensure bass clef integration is complete:

1. **Count bass nodes:**
```bash
# Should output 25 total bass nodes
node -e "
  import('./src/data/expandedNodes.js').then(m => {
    const bass = m.EXPANDED_BASS_NODES;
    console.log('Total bass nodes:', bass.length);
    console.log('Unit 1:', bass.filter(n => n.unit === 1).length);
    console.log('Unit 2:', bass.filter(n => n.unit === 2).length);
    console.log('Unit 3:', bass.filter(n => n.unit === 3).length);
    console.log('Boss nodes:', bass.filter(n => n.isBoss).length);
  });
"
```

Expected output:
- Total bass nodes: 25
- Unit 1: 7 (including boss)
- Unit 2: 8 (including boss)
- Unit 3: 10 (including boss)
- Boss nodes: 3

2. **Verify prerequisite chain:**
```bash
node -e "
  import('./src/data/expandedNodes.js').then(m => {
    const bass = m.EXPANDED_BASS_NODES;
    // Check Unit 2 starts after Unit 1 boss
    const unit2Start = bass.find(n => n.id === 'bass_2_1');
    console.log('Unit 2 prereq:', unit2Start?.prerequisites);
    // Check Unit 3 starts after Unit 2 boss
    const unit3Start = bass.find(n => n.id === 'bass_3_1');
    console.log('Unit 3 prereq:', unit3Start?.prerequisites);
  });
"
```

Expected:
- Unit 2 prereq: ['boss_bass_1']
- Unit 3 prereq: ['boss_bass_2']

3. **Verify all nodes have bass clef:**
```bash
node -e "
  import('./src/data/expandedNodes.js').then(m => {
    const bass = m.EXPANDED_BASS_NODES;
    const allBass = bass.every(n => n.noteConfig?.clef === 'bass');
    console.log('All bass clef:', allBass);
    if (!allBass) {
      bass.filter(n => n.noteConfig?.clef !== 'bass').forEach(n =>
        console.log('Wrong clef:', n.id, n.noteConfig?.clef)
      );
    }
  });
"
```

Expected: All bass clef: true
  </action>
  <verify>
All three validation checks pass:
1. Node count: 25 total (7 + 8 + 10)
2. Prerequisites: boss_bass_1 -> Unit 2, boss_bass_2 -> Unit 3
3. Clef: All nodes use clef: 'bass'
  </verify>
  <done>
Bass clef integration validated:
- 25 nodes across 3 units
- Prerequisite chain correct
- All nodes use bass clef
- Build and validation pass
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run verify:patterns` passes
3. EXPANDED_BASS_NODES array has 25 nodes
4. Unit prerequisite chain: Unit 1 -> boss_bass_1 -> Unit 2 -> boss_bass_2 -> Unit 3
5. All bass nodes have `noteConfig.clef: 'bass'`
6. Legacy `generateUnit()` no longer used for bass clef (kept for rhythm)
</verification>

<success_criteria>
- expandedNodes.js imports all three redesigned bass unit files
- Legacy bass generation code removed
- EXPANDED_NODES contains 25 bass clef nodes
- Build passes with no errors
- Validation passes with no errors
- Prerequisite chain verified (Unit 1 -> Unit 2 -> Unit 3)
</success_criteria>

<output>
After completion, create `.planning/phases/09-bass-clef-implementation/09-04-SUMMARY.md`
</output>
