---
phase: 09-bass-clef-implementation
plan: 04
type: execute
wave: 2
depends_on: ["09-01", "09-02", "09-03"]
files_modified:
  - src/data/expandedNodes.js
autonomous: true

must_haves:
  truths:
    - "Bass clef units are integrated into the trail system"
    - "Legacy bass clef generator code is replaced with redesigned imports"
    - "All 25 bass clef nodes appear in EXPANDED_NODES array"
    - "Prerequisite chain links Unit 1 -> Unit 2 -> Unit 3 correctly"
  artifacts:
    - path: "src/data/expandedNodes.js"
      provides: "Integrated trail with redesigned bass units"
      contains: "import.*bassUnit1Nodes.*from.*bassUnit1Redesigned"
  key_links:
    - from: "src/data/expandedNodes.js"
      to: "src/data/units/bassUnit1Redesigned.js"
      via: "import statement"
      pattern: "import.*bassUnit1Nodes"
    - from: "src/data/expandedNodes.js"
      to: "src/data/units/bassUnit2Redesigned.js"
      via: "import statement"
      pattern: "import.*bassUnit2Nodes"
    - from: "src/data/expandedNodes.js"
      to: "src/data/units/bassUnit3Redesigned.js"
      via: "import statement"
      pattern: "import.*bassUnit3Nodes"
---

<objective>
Integrate the three redesigned bass clef units into expandedNodes.js, replacing the legacy generator-based bass units.

Purpose: Connect the new pedagogy-driven bass clef nodes to the main trail system. Remove dependency on legacy `generateUnit()` for bass clef while preserving rhythm units (which will be redesigned in Phase 10).

Output: Updated `expandedNodes.js` that imports and exports redesigned bass units.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-bass-clef-implementation/09-CONTEXT.md

# File to modify
@src/data/expandedNodes.js

# New unit files created in prior plans
@src/data/units/bassUnit1Redesigned.js
@src/data/units/bassUnit2Redesigned.js
@src/data/units/bassUnit3Redesigned.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update expandedNodes.js with redesigned bass imports</name>
  <files>src/data/expandedNodes.js</files>
  <action>
Modify `src/data/expandedNodes.js` to:

1. **Add new imports** (after treble imports, before legacy generator import):
```javascript
import bassUnit1Nodes from './units/bassUnit1Redesigned.js';
import bassUnit2Nodes from './units/bassUnit2Redesigned.js';
import bassUnit3Nodes from './units/bassUnit3Redesigned.js';
```

2. **Remove legacy bass unit generation** (delete these blocks):
```javascript
// DELETE: const bassUnit1 = generateUnit({...})
// DELETE: const bassUnit2 = generateUnit({...})
```

3. **Update EXPANDED_NODES** to use redesigned imports:
```javascript
export const EXPANDED_NODES = [
  // Redesigned treble clef units (Units 1-3)
  ...trebleUnit1Nodes,
  ...trebleUnit2Nodes,
  ...trebleUnit3Nodes,

  // Redesigned bass clef units (Units 1-3)
  ...bassUnit1Nodes,
  ...bassUnit2Nodes,
  ...bassUnit3Nodes,

  // Legacy rhythm units (to be redesigned in Phase 10)
  ...rhythmUnit1,
  ...rhythmUnit2
];
```

4. **Update EXPANDED_BASS_NODES** export:
```javascript
export const EXPANDED_BASS_NODES = [
  ...bassUnit1Nodes,
  ...bassUnit2Nodes,
  ...bassUnit3Nodes
];
```

5. **Simplify linkUnitPrerequisites** function:
- Remove the bass unit prerequisite linking code (now handled in unit files)
- Keep the rhythm unit prerequisite linking (still needed for legacy rhythm units)

**Keep unchanged:**
- Treble unit imports (already redesigned)
- Rhythm unit generation (Phase 10 work)
- NODE_CATEGORIES import

**File header update:**
```javascript
/**
 * Expanded Trail Nodes - Redesigned System
 *
 * Educational psychology-driven trail system for 8-year-old learners.
 *
 * Treble Units 1-3: Redesigned (C4 to C5, quarters + halves only)
 * Bass Units 1-3: Redesigned (C4 to C3, quarters + halves only)
 * Rhythm Units 1-2: Legacy generator (to be redesigned in Phase 10)
 *
 * This file imports the redesigned units and combines them.
 */
```
  </action>
  <verify>
1. Run `npm run verify:trail` - should pass with no bass clef errors
2. Run `npm run build` - should build successfully
3. Check EXPANDED_NODES includes all 25 bass nodes (7 + 8 + 10)
  </verify>
  <done>
expandedNodes.js updated with:
- Imports for bassUnit1Nodes, bassUnit2Nodes, bassUnit3Nodes
- Legacy generateUnit() calls removed for bass clef
- EXPANDED_BASS_NODES uses redesigned arrays
- Build passes, validation passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate complete bass clef integration</name>
  <files>src/data/expandedNodes.js</files>
  <action>
Run comprehensive validation to ensure bass clef integration is complete:

1. **Run existing validation:**
```bash
npm run verify:trail
```
This validates all node structures including bass units. Should pass with 0 errors.

2. **Run build to verify imports:**
```bash
npm run build
```
Build will fail if any imports are broken.

3. **Verify import statements exist:**
```bash
grep -E "import.*bassUnit[123]Nodes.*from.*bassUnit[123]Redesigned" src/data/expandedNodes.js
```
Should show 3 import lines for bass units.

4. **Count bass nodes via grep:**
```bash
grep -c "id: 'bass_" src/data/units/bassUnit1Redesigned.js src/data/units/bassUnit2Redesigned.js src/data/units/bassUnit3Redesigned.js
```
Expected: bassUnit1=7, bassUnit2=8, bassUnit3=10 (total 25)

5. **Verify prerequisite chain via grep:**
```bash
grep "prerequisites: \['boss_bass_1'\]" src/data/units/bassUnit2Redesigned.js
grep "prerequisites: \['boss_bass_2'\]" src/data/units/bassUnit3Redesigned.js
```
Should find first node of each unit pointing to previous boss.
  </action>
  <verify>
All validation checks pass:
1. `npm run verify:trail` passes with 0 errors
2. `npm run build` succeeds
3. Import statements found for all 3 bass unit files
4. Node count: 25 total (7 + 8 + 10)
5. Prerequisites: bass_2_1 requires boss_bass_1, bass_3_1 requires boss_bass_2
  </verify>
  <done>
Bass clef integration validated:
- 25 nodes across 3 units
- Prerequisite chain correct
- All nodes use bass clef
- Build and validation pass
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run verify:trail` passes
3. EXPANDED_BASS_NODES array has 25 nodes
4. Unit prerequisite chain: Unit 1 -> boss_bass_1 -> Unit 2 -> boss_bass_2 -> Unit 3
5. All bass nodes have `noteConfig.clef: 'bass'`
6. Legacy `generateUnit()` no longer used for bass clef (kept for rhythm)
</verification>

<success_criteria>
- expandedNodes.js imports all three redesigned bass unit files
- Legacy bass generation code removed
- EXPANDED_NODES contains 25 bass clef nodes
- Build passes with no errors
- Validation passes with no errors
- Prerequisite chain verified (Unit 1 -> Unit 2 -> Unit 3)
</success_criteria>

<output>
After completion, create `.planning/phases/09-bass-clef-implementation/09-04-SUMMARY.md`
</output>
