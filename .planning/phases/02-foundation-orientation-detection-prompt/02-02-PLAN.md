---
phase: 02-foundation-orientation-detection-prompt
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/games/notes-master-games/NotesRecognitionGame.jsx
  - src/components/games/sight-reading-game/SightReadingGame.jsx
  - src/components/games/rhythm-games/MetronomeTrainer.jsx
  - src/components/games/notes-master-games/MemoryGame.jsx
autonomous: false

must_haves:
  truths:
    - "User entering any of the 4 game modes in portrait mode on mobile sees the rotate prompt overlay"
    - "Rotate prompt disappears automatically when user rotates device to landscape"
    - "User can dismiss rotate prompt with Play anyway button and it never shows again"
    - "Rotate prompt does not appear on desktop devices or when already in landscape"
    - "Rotate prompt appears before the settings modal (immediately on game entry)"
  artifacts:
    - path: "src/components/games/notes-master-games/NotesRecognitionGame.jsx"
      provides: "Notes recognition game with rotate prompt integration"
      contains: "useRotatePrompt"
    - path: "src/components/games/sight-reading-game/SightReadingGame.jsx"
      provides: "Sight reading game with rotate prompt integration"
      contains: "useRotatePrompt"
    - path: "src/components/games/rhythm-games/MetronomeTrainer.jsx"
      provides: "Rhythm game with rotate prompt integration"
      contains: "useRotatePrompt"
    - path: "src/components/games/notes-master-games/MemoryGame.jsx"
      provides: "Memory/boss game with rotate prompt integration"
      contains: "useRotatePrompt"
  key_links:
    - from: "src/components/games/notes-master-games/NotesRecognitionGame.jsx"
      to: "src/hooks/useRotatePrompt.js"
      via: "hook import"
      pattern: "import.*useRotatePrompt"
    - from: "src/components/games/notes-master-games/NotesRecognitionGame.jsx"
      to: "src/components/orientation/RotatePromptOverlay.jsx"
      via: "component import"
      pattern: "import.*RotatePromptOverlay"
---

<objective>
Integrate the rotate prompt overlay into all 4 game modes so mobile users in portrait see the prompt on game entry.

Purpose: Complete the orientation detection & prompt feature by wiring hooks and overlay into every game entry point.
Output: All 4 game components show the rotate prompt when conditions are met.
</objective>

<execution_context>
@C:/Users/pagis/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/pagis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/02-foundation-orientation-detection-prompt/02-01-SUMMARY.md — Hook and component from Plan 01
@src/components/games/notes-master-games/NotesRecognitionGame.jsx
@src/components/games/sight-reading-game/SightReadingGame.jsx
@src/components/games/rhythm-games/MetronomeTrainer.jsx
@src/components/games/notes-master-games/MemoryGame.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate rotate prompt into all 4 game components</name>
  <files>
    src/components/games/notes-master-games/NotesRecognitionGame.jsx,
    src/components/games/sight-reading-game/SightReadingGame.jsx,
    src/components/games/rhythm-games/MetronomeTrainer.jsx,
    src/components/games/notes-master-games/MemoryGame.jsx
  </files>
  <action>
    For each of the 4 game components, add the rotate prompt integration following this pattern:

    **Imports to add (at top of file):**
    ```javascript
    import { useRotatePrompt } from "../../../hooks/useRotatePrompt";  // adjust relative path per file
    import { RotatePromptOverlay } from "../../orientation/RotatePromptOverlay";  // adjust relative path per file
    ```

    Note: Path adjustments needed:
    - NotesRecognitionGame.jsx: `../../../hooks/useRotatePrompt` and `../../orientation/RotatePromptOverlay`
    - SightReadingGame.jsx: `../../../hooks/useRotatePrompt` and `../../orientation/RotatePromptOverlay`
    - MetronomeTrainer.jsx: `../../../hooks/useRotatePrompt` and `../../orientation/RotatePromptOverlay`
    - MemoryGame.jsx: `../../../hooks/useRotatePrompt` and `../../orientation/RotatePromptOverlay`

    **Hook usage (inside component function, near top with other hooks):**
    ```javascript
    const { shouldShowPrompt, dismissPrompt } = useRotatePrompt();
    ```

    **JSX insertion (FIRST child inside the outermost container div, BEFORE settings modal and all other content):**
    ```jsx
    {shouldShowPrompt && <RotatePromptOverlay onDismiss={dismissPrompt} />}
    ```

    Per user decision: prompt shows immediately on game entry, BEFORE the settings modal. Place the overlay render FIRST in the JSX tree so it renders on top.

    **Important:** The overlay uses `fixed inset-0 z-[9999]` so it will cover everything regardless of position in JSX, but placing it first makes the intent clear. Do NOT wrap the existing game content in any conditional — the game loads normally behind the overlay.

    **Do NOT modify any existing game logic, state, or UI.** This is purely additive — 2 import lines, 1 hook call, 1 JSX line per component.
  </action>
  <verify>
    - All 4 files import useRotatePrompt and RotatePromptOverlay
    - All 4 files call useRotatePrompt() hook
    - All 4 files render RotatePromptOverlay conditionally with shouldShowPrompt
    - `npm run build` succeeds with no errors
    - No existing game logic was modified
  </verify>
  <done>All 4 game modes (NotesRecognitionGame, SightReadingGame, MetronomeTrainer, MemoryGame) render the rotate prompt overlay when user is on mobile in portrait mode.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify rotate prompt on mobile device</name>
  <files>N/A — human verification checkpoint</files>
  <action>
    Verify the rotate prompt overlay works correctly across all scenarios. This is automated work from Task 1 that needs visual/functional verification on a real or emulated mobile device.

    **What was built:** Rotate prompt overlay integrated into all 4 game modes with orientation detection, permanent dismiss, auto-dismiss on rotation, and re-show-once behavior.
  </action>
  <verify>
    1. Open `npm run dev` on a mobile device (or use Chrome DevTools mobile emulation with Device Toolbar enabled)
    2. Navigate to any game mode (e.g., Notes Recognition from dashboard or trail)
    3. **In portrait mode:** Verify a full-screen dark overlay appears with:
       - An animated tilting phone icon with mini piano keys
       - Text "Turn Your Phone Sideways!" and subtitle
       - A "Play anyway" button at the bottom
    4. **Rotate to landscape:** Verify the overlay fades out smoothly and the game is visible
    5. **Rotate back to portrait:** Verify the overlay reappears ONE more time (re-show once)
    6. **Rotate to landscape again:** Verify the overlay fades out and does NOT reappear if you rotate back to portrait again
    7. **Test permanent dismiss:** Refresh the page in portrait mode, enter a game, tap "Play anyway" — verify the overlay never appears again (even after refreshing)
    8. **Test desktop:** Open the same game on desktop browser — verify NO overlay appears regardless of window size
    9. **Test all 4 games:** Repeat step 2-3 for Sight Reading, Rhythm, and Memory/Boss game modes
    10. Clear localStorage key `pianoapp-rotate-dismissed` to reset for future testing
  </verify>
  <done>User confirms rotate prompt works correctly: appears on mobile portrait, auto-dismisses on landscape, re-shows once, permanently dismisses with "Play anyway", and does not appear on desktop. Type "approved" or describe issues.</done>
</task>

</tasks>

<verification>
- All 4 game components have rotate prompt integration
- Build passes: `npm run build`
- Lint passes: `npm run lint`
- Overlay appears on mobile portrait, disappears on landscape, dismisses permanently
- Desktop users never see the overlay
- No regressions in existing game functionality
</verification>

<success_criteria>
- User entering any of the 4 game modes in portrait mode on mobile sees animated rotate prompt
- Prompt auto-dismisses on landscape rotation with smooth fade-out
- "Play anyway" permanently dismisses (localStorage persisted)
- Re-show once works: shows again first time user rotates back to portrait, then stops
- Desktop users unaffected
- All 5 success criteria from Phase 02 roadmap are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/02-foundation-orientation-detection-prompt/02-02-SUMMARY.md`
</output>
