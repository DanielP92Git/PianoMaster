# Milestone v1.3: Trail System Redesign

**Status:** SHIPPED 2026-02-05
**Phases:** 8-12
**Total Plans:** 14

## Overview

This milestone redesigned the trail data layer with consistent pedagogy across all three paths (Treble, Bass, Rhythm). Starting with data modeling and validation infrastructure, we then implemented 22 Bass Clef nodes mirroring the treble pedagogy, followed by 36 Rhythm nodes with duration-based progression across 6 units. Finally, we performed atomic cutover and validation to ensure existing user progress was preserved.

## Phases

### Phase 8: Design & Data Modeling

**Goal**: Establish validation infrastructure and document pedagogy decisions before implementation
**Depends on**: Nothing (first phase of v1.3)
**Plans**: 2 plans

Plans:
- [x] 08-01-PLAN.md — Build-time validation script + npm integration
- [x] 08-02-PLAN.md — Pedagogy documentation (PEDAGOGY.md)

**Details:**
- Created `scripts/validateTrail.mjs` (263 LOC) with DFS cycle detection
- Integrated into npm lifecycle via `prebuild` and `verify:trail` scripts
- Documented pedagogy decisions for all three paths

### Phase 9: Bass Clef Implementation

**Goal**: 22 bass clef nodes following treble pedagogy pattern (Discovery, Practice, Mix-Up, Speed, Boss)
**Depends on**: Phase 8 (needs validation infrastructure)
**Plans**: 4 plans

Plans:
- [x] 09-01-PLAN.md — Bass Unit 1: Middle C Position (7 nodes: C4, B3, A3)
- [x] 09-02-PLAN.md — Bass Unit 2: Five Finger Low (8 nodes: adds G3, F3)
- [x] 09-03-PLAN.md — Bass Unit 3: The Full Octave (7 nodes: adds E3, D3, C3)
- [x] 09-04-PLAN.md — Integration into expandedNodes.js + validation

**Details:**
- START_ORDER = 51 for bass clef (after treble units)
- ledgerLines: true for bass C4 (requires ledger line in bass clef)
- Unit prerequisites set in unit files, not at runtime

### Phase 10: Rhythm Implementation

**Goal**: 36 rhythm nodes (6 units) with duration-based progression from quarter notes to sixteenths
**Depends on**: Phase 8 (needs validation infrastructure)
**Plans**: 4 plans

Plans:
- [x] 10-01-PLAN.md — Units 1-2: Basic Beats (quarter+half) and Complete Basics (add whole)
- [x] 10-02-PLAN.md — Units 3-4: Running Notes (eighths) and Sound of Silence (rests)
- [x] 10-03-PLAN.md — Units 5-6: Dotted Notes (3/4 time) and Sixteenths (final unit)
- [x] 10-04-PLAN.md — Integration into expandedNodes.js + validation

**Details:**
- START_ORDER = 100 for rhythm units (clear separation from clef units)
- Single pitch C4 for all rhythm nodes (pure rhythm focus)
- Tempo ranges: 60-70 BPM (discovery), 85-95 BPM (speed)
- Each rest type gets dedicated Discovery node (silence is a skill)

### Phase 11: Integration & Cutover

**Goal**: Atomic switch from legacy nodes to new structure with progress reset (XP preserved)
**Depends on**: Phases 9 and 10 (need all unit files complete)
**Plans**: 2 plans

Plans:
- [x] 11-01-PLAN.md — Core cutover (migration + skillTrail.js update)
- [x] 11-02-PLAN.md — Build verification + smoke test

**Details:**
- 93 nodes in final system (was estimated as 87 in planning)
- Silent progress reset per PEDAGOGY.md, XP totals preserved
- Fixed rhythm timeSignature bug during smoke test (string-to-object conversion)

### Phase 12: Validation & Cleanup

**Goal**: Verify trail works with production data and remove all legacy code
**Depends on**: Phase 11 (cutover must be complete)
**Plans**: 2 plans

Plans:
- [x] 12-01-PLAN.md — Delete LEGACY_NODES and audit dead code
- [x] 12-02-PLAN.md — E2E verification and documentation update

**Details:**
- Removed progressMigration.js usage (all progress reset in v1.3)
- Human verification for E2E trail paths (all three paths playable)
- Navigation bug fix included in shipped state
- XP display gap documented as feature gap (non-blocking)

---

## Milestone Summary

**Key Decisions:**
- Validation runs at prebuild, fails on errors (catches issues before deploy)
- START_ORDER = 51 for bass, 100 for rhythm (clear separation)
- Single pitch C4 for all rhythm nodes (pure rhythm focus)
- 93 nodes in final system (actual count after implementation)
- Silent progress reset, XP preserved (maintains motivation)

**Issues Resolved:**
- Legacy 18-node system replaced with 93-node unified trail
- Duplicate nodes eliminated (LEGACY_NODES removed)
- nodeGenerator.js dependency removed for main paths
- Rhythm timeSignature bug fixed (string-to-object conversion)
- Navigation state persistence bug fixed

**Issues Deferred:**
- XP display in UI could be more prominent (feature gap, non-blocking)
- Daily goals progress bars could update more frequently (60s poll)

**Technical Debt Incurred:**
- Missing 12-VERIFICATION.md file (documentation only)
- Orphaned progressMigration.js file (175 lines unused) - to delete
- Migration SQL comment says "87 nodes" but actual is 93
- 50.2% XP variance between paths (pedagogically intentional)

---

_For current project status, see .planning/PROJECT.md_

---
*Archived: 2026-02-05 as part of v1.3 milestone completion*
