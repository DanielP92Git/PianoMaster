# Requirements Archive: v1.5 Trail Page Visual Redesign

**Archived:** 2026-02-12
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: v1.5 Trail Page Visual Redesign

**Milestone:** v1.5
**Source:** Stitch design "Piano Learning Trail Redesign V2" (screen c8f29a94cd5e4ba3890d83c1d0554afe)
**Scope:** Trail page only (TrailMapPage, TrailMap, TrailNode, PathConnector)
**Constraint:** Zero database changes. Pure UI redesign.

---

## CSS-01: Enchanted Forest Background

Replace current `bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900` with a CSS-only enchanted forest background.

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| CSS-01a | Multi-layer gradient background | Deep purple/navy gradient with at least 3 color stops matching Stitch design (`#0f172a` base) |
| CSS-01b | Decorative blur elements | Ambient glow orbs (purple, blue, green) positioned via absolute pseudo-elements. Matches bottom-of-screen mushroom glow from Stitch reference |
| CSS-01c | Animated starfield | Twinkling stars using CSS keyframes. Must respect `prefers-reduced-motion` and `reducedMotion` from AccessibilityContext |
| CSS-01d | CSS-only, no images | Background must not use `<img>` tags or external image URLs. Gradients and CSS effects only |

## CSS-02: Custom CSS Properties & Utilities

Create trail-scoped CSS module with design tokens from Stitch reference.

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| CSS-02a | CSS custom properties | Define `--color-primary-glow: #00f2ff`, `--color-secondary-glow: #aa00ff`, `--color-glass-bg`, `--color-glass-border` per Stitch reference |
| CSS-02b | trail-effects.css module | Dedicated CSS file scoped to trail page. Not added to global styles |
| CSS-02c | Tailwind config extensions | Add `fontFamily.quicksand`, custom colors (`cyan-glow`, `purple-glow`), shadow utilities to tailwind.config |
| CSS-02d | Reduced motion overrides | Every `@keyframes` animation has `@media (prefers-reduced-motion: reduce)` override that disables or reduces it |

## FONT-01: Quicksand Font Integration

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| FONT-01a | Install @fontsource/quicksand | Self-hosted via npm (COPPA compliant). Weights: 400, 600, 700 |
| FONT-01b | Trail page scoped | Quicksand applied to trail page elements only, not globally. Other pages unaffected |
| FONT-01c | Font display swap | Use `font-display: swap` to prevent FOUT blocking rendering |

## NODE-01: 3D Node Button Styling

Transform flat TrailNode buttons into 3D game-like buttons matching Stitch design.

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| NODE-01a | Active node 3D effect | Radial gradient center highlight (`radial-gradient(circle at 50% 30%, #4facfe, #00f2fe)`), layered box-shadows for depth (dark side + glow + inset highlight) per Stitch `.node-active` class |
| NODE-01b | Locked node dark styling | Dark purple radial gradient with subdued shadows per Stitch `.node-locked` class. Lock icon visible |
| NODE-01c | Completed node green glow | Green radial gradient with earned stars displayed prominently. Cyan glow ring for mastered (3-star) nodes |
| NODE-01d | Press animation | `:active` pushes node down (`translateY(4px)`) with reduced shadow. Quick `0.1s` transition |
| NODE-01e | Node size increase | Nodes 90-96px diameter (currently ~70px) for better tap targets on mobile. Boss nodes slightly larger |
| NODE-01f | Pseudo-element glow layers | Glow effects rendered on `::before` pseudo-elements. Animate `opacity` only (not `box-shadow`) to avoid paint storms |
| NODE-01g | Existing icon system preserved | Keep current 8 node-type icons (lucide-react) and colorblind-safe palette from v1.4. Boss crown retained |

## NODE-02: Node State Visual Distinction

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| NODE-02a | Active/available: cyan glow ring | Pulsing glow effect around unlocked-but-not-completed nodes. Respects reducedMotion |
| NODE-02b | Completed: star count below node | Yellow filled stars (earned) and gray empty stars (unearned) displayed below node, per Stitch layout |
| NODE-02c | Locked: dark + lock overlay | Low opacity, dark purple, non-interactive appearance. Lock indicator visible |
| NODE-02d | Current node indicator | "Start Here" or "Continue" label on the next recommended node. Brighter/more prominent than other available nodes |

## TAB-01: Path Tab Switcher

Replace 3 simultaneous TrailSections with tab-based single-path display.

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| TAB-01a | Three tabs: Treble, Bass, Rhythm | Button group at top of trail area. Active tab visually distinct (filled/glow) |
| TAB-01b | One path visible at a time | Only selected category's nodes render. Other paths hidden, not just scrolled away |
| TAB-01c | Tab persistence in URL | Active tab stored as URL query param (`?path=treble`). Supports browser back button and sharing |
| TAB-01d | ARIA tab pattern | `role="tablist"`, `role="tab"`, `aria-selected`, keyboard navigation (arrow keys) per W3C ARIA tab pattern |
| TAB-01e | Boss nodes integrated | Boss nodes for the active category shown inline at appropriate positions (end of units), not in separate section |

## LAYOUT-01: Vertical Zigzag Trail (Mobile)

Replace UnitSection collapsible card layout with vertical zigzag trail on mobile (<768px).

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| LAYOUT-01a | Zigzag node positioning | Nodes alternate left/right (approximately 25%/75% horizontal position) creating S-curve visual. Matches Stitch absolute positioning pattern (left: 100px / 200px / 300px alternating) |
| LAYOUT-01b | SVG S-curve path connections | Bezier curve paths connecting consecutive nodes with `stroke: #00FFFF` and `filter: drop-shadow()` glow. Matches Stitch SVG path style |
| LAYOUT-01c | Vertical scrolling | Trail scrolls naturally vertically on mobile. No horizontal scroll. Nodes evenly spaced vertically |
| LAYOUT-01d | Node labels below each node | Node name text below each node, white, bold, centered. Matches Stitch `text-shadow-custom` pattern |
| LAYOUT-01e | Unit boundaries indicated | Visual separator or badge when crossing from one unit to the next (e.g., glass-panel unit header card) |
| LAYOUT-01f | Viewport-based rendering | Use Intersection Observer to animate only visible path connectors. Critical for 93-node performance |

## LAYOUT-02: Horizontal Trail (Desktop)

Desktop (>=768px) displays trail horizontally.

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| LAYOUT-02a | Horizontal wavy path | Nodes arranged in horizontal row with wavy vertical offset, similar to current layout but with 3D node styling |
| LAYOUT-02b | Responsive breakpoint at 768px | `useMediaQuery` hook switches between vertical (mobile) and horizontal (desktop) layout components |
| LAYOUT-02c | Horizontal scroll or wrap | Desktop trail scrolls horizontally or wraps to multiple rows as needed for 23+ nodes per path |

## GLASS-01: Glass-morphism Cards

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| GLASS-01a | Unit progress card | Glass panel showing unit name, completion count, and star count. Matches Stitch `.glass-panel` class (`backdrop-filter: blur(12px)`, gradient bg, border) |
| GLASS-01b | Limited backdrop-filter usage | Backdrop-filter applied to max 3 elements on screen simultaneously. Performance critical for Chromebooks |
| GLASS-01c | WCAG 4.5:1 contrast | All text on glass panels meets contrast requirements. Semi-opaque overlay ensures readability |
| GLASS-01d | Inner glow accent | Decorative blur element inside card (green/purple glow, absolute positioned) per Stitch pattern |

## HEADER-01: Trail Page Header

Redesign trail page header to match Stitch reference.

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| HEADER-01a | Level badge | Compact badge showing level number with star icon. Gold border. Dark background. Matches Stitch header badge |
| HEADER-01b | "Learning Trail" title | Center-aligned title with Quicksand font and `.text-glow` cyan text shadow |
| HEADER-01c | "Free Practice" button | Gradient button (blue→cyan) with glow shadow. Links to `/practice-modes` |
| HEADER-01d | Back navigation preserved | Dashboard back link still accessible |

## PATH-01: Animated Path Connectors

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| PATH-01a | Cyan glow path stroke | SVG paths with `stroke: #00FFFF`, `stroke-width: 6`, `filter: drop-shadow(0 0 8px #00FFFF)` for completed sections |
| PATH-01b | Dashed path for locked sections | Incomplete/locked path sections use dashed stroke with muted color |
| PATH-01c | CSS filter, not SVG filter | Use CSS `filter: drop-shadow()` instead of SVG `<filter>` elements for better performance |

## A11Y-01: Accessibility Compliance

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| A11Y-01a | Reduced motion support | All CSS animations and Framer Motion transitions check `reducedMotion` from AccessibilityContext AND `prefers-reduced-motion` media query. No animation when either is active |
| A11Y-01b | 48dp minimum tap targets | All interactive elements (nodes, tabs, buttons) meet 48x48dp minimum touch target |
| A11Y-01c | Color not sole indicator | Node states distinguishable by icon, label, and shape in addition to color (existing v1.4 colorblind-safe system preserved) |
| A11Y-01d | Screen reader trail navigation | Trail nodes announced with name, state, and position. Tab switcher keyboard accessible |

## PERF-01: Performance Requirements

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| PERF-01a | 60fps on Chromebook | Trail scrolling and node interactions maintain 60fps on Intel Celeron Chromebook |
| PERF-01b | will-change limited | `will-change` applied to max 10 elements simultaneously. Removed when not actively animating |
| PERF-01c | No box-shadow animation | Box-shadows pre-rendered on pseudo-elements. Only `opacity` and `transform` animated |
| PERF-01d | Service worker cache bump | Bump `pianomaster-v2` to `pianomaster-v3` in `public/sw.js`. Old caches deleted on activate |

## COMPAT-01: Compatibility

| REQ | Description | Acceptance Criteria |
|-----|-------------|---------------------|
| COMPAT-01a | Existing progress unaffected | No changes to skillTrail.js, skillProgressService.js, or database. All 93 nodes and progress data intact |
| COMPAT-01b | TrailNodeModal unchanged | Modal functionality (click node -> details -> start practice) works identically |
| COMPAT-01c | Game navigation preserved | Trail -> game -> VictoryScreen -> trail flow works identically |
| COMPAT-01d | RTL support maintained | Trail page respects RTL direction for Hebrew users |

---

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| CSS-01a | Phase 19 | Pending |
| CSS-01b | Phase 19 | Pending |
| CSS-01c | Phase 19 | Pending |
| CSS-01d | Phase 19 | Pending |
| CSS-02a | Phase 19 | Pending |
| CSS-02b | Phase 19 | Pending |
| CSS-02c | Phase 19 | Pending |
| CSS-02d | Phase 19 | Pending |
| FONT-01a | Phase 19 | Pending |
| FONT-01b | Phase 19 | Pending |
| FONT-01c | Phase 19 | Pending |
| NODE-01a | Phase 20 | Pending |
| NODE-01b | Phase 20 | Pending |
| NODE-01c | Phase 20 | Pending |
| NODE-01d | Phase 20 | Pending |
| NODE-01e | Phase 20 | Pending |
| NODE-01f | Phase 20 | Pending |
| NODE-01g | Phase 20 | Pending |
| NODE-02a | Phase 20 | Pending |
| NODE-02b | Phase 20 | Pending |
| NODE-02c | Phase 20 | Pending |
| NODE-02d | Phase 20 | Pending |
| TAB-01a | Phase 20 | Pending |
| TAB-01b | Phase 20 | Pending |
| TAB-01c | Phase 20 | Pending |
| TAB-01d | Phase 20 | Pending |
| TAB-01e | Phase 20 | Pending |
| HEADER-01a | Phase 20 | Pending |
| HEADER-01b | Phase 20 | Pending |
| HEADER-01c | Phase 20 | Pending |
| HEADER-01d | Phase 20 | Pending |
| LAYOUT-01a | Phase 21 | Pending |
| LAYOUT-01b | Phase 21 | Pending |
| LAYOUT-01c | Phase 21 | Pending |
| LAYOUT-01d | Phase 21 | Pending |
| LAYOUT-01e | Phase 21 | Pending |
| LAYOUT-01f | Phase 21 | Pending |
| LAYOUT-02a | Phase 21 | Pending |
| LAYOUT-02b | Phase 21 | Pending |
| LAYOUT-02c | Phase 21 | Pending |
| PATH-01a | Phase 21 | Pending |
| PATH-01b | Phase 21 | Pending |
| PATH-01c | Phase 21 | Pending |
| GLASS-01a | Phase 21 | Pending |
| GLASS-01b | Phase 21 | Pending |
| GLASS-01c | Phase 21 | Pending |
| GLASS-01d | Phase 21 | Pending |
| A11Y-01a | Phase 19 | Pending |
| A11Y-01b | Phase 22 | Pending |
| A11Y-01c | Phase 22 | Pending |
| A11Y-01d | Phase 22 | Pending |
| PERF-01a | Phase 21 | Pending |
| PERF-01b | Phase 19 | Pending |
| PERF-01c | Phase 19 | Pending |
| PERF-01d | Phase 22 | Pending |
| COMPAT-01a | Phase 20 | Pending |
| COMPAT-01b | Phase 20 | Pending |
| COMPAT-01c | Phase 22 | Pending |
| COMPAT-01d | Phase 22 | Pending |

**Coverage:** 59/59 requirements mapped ✓

---

## Summary

| Category | Count | Priority |
|----------|-------|----------|
| CSS Foundation (CSS-01, CSS-02) | 8 | P0 |
| Font (FONT-01) | 3 | P0 |
| Node Styling (NODE-01, NODE-02) | 11 | P0 |
| Tab Switcher (TAB-01) | 5 | P0 |
| Layout - Mobile (LAYOUT-01) | 6 | P0 |
| Layout - Desktop (LAYOUT-02) | 3 | P1 |
| Glass-morphism (GLASS-01) | 4 | P1 |
| Header (HEADER-01) | 4 | P1 |
| Path Connectors (PATH-01) | 3 | P1 |
| Accessibility (A11Y-01) | 4 | P0 |
| Performance (PERF-01) | 4 | P0 |
| Compatibility (COMPAT-01) | 4 | P0 |
| **Total** | **59** | |

**Zero database changes. Zero new dependencies except @fontsource/quicksand.**

---
*Generated: 2026-02-10*
*Design reference: .planning/design-references/stitch-trail-v2.html*
